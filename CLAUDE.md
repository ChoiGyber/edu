ğŸ—ï¸ ê±´ì„¤ ì•ˆì „êµìœ¡ í”Œë«í¼ - ì¢…í•© ê°œë°œ ëª…ì„¸ì„œ
ğŸ“Œ ëª©ì°¨

í”„ë¡œì íŠ¸ ê°œìš”
ê¸°ìˆ  ìŠ¤íƒ ë° ì•„í‚¤í…ì²˜
ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„
í•µì‹¬ ê¸°ëŠ¥ ëª…ì„¸
ì˜ìƒ ì œê³µì ëª¨ë“ˆ ì‹œìŠ¤í…œ
êµìœ¡ ì¡°í•© ë…¸ë“œ ì—ë””í„°
ë‹¤êµ­ì–´ ë° ìë§‰ ì‹œìŠ¤í…œ
QR ê¸°ë°˜ ì¦ë¹™ ì‹œìŠ¤í…œ
PDF ìë™ ìƒì„±
êµìœ¡ ì´ë ¥ ê´€ë¦¬
ë³´ì•ˆ ë° ì ‘ê·¼ ì œì–´
API ëª…ì„¸
ê°œë°œ ë¡œë“œë§µ
ë°°í¬ ë° ìš´ì˜


1. í”„ë¡œì íŠ¸ ê°œìš”
1.1. í”„ë¡œì íŠ¸ëª…
ì•ˆì „êµìœ¡ í”Œë«í¼ (Safety Education Platform)
1.2. í•µì‹¬ ê°€ì¹˜ ì œì•ˆ

ğŸ“¹ 10ë¶„ëŒ€ ì§§ì€ ì˜ìƒì„ ë…¸ë“œ ì¡°í•© ë°©ì‹ìœ¼ë¡œ ì»¤ìŠ¤í…€ êµìœ¡ ê³¼ì • ìƒì„±
ğŸ“± QR ì½”ë“œ + ëª¨ë°”ì¼ ì¦ë¹™ (ì´ë¦„, ì „ìì„œëª…, ì…€ì¹´) ìë™ ìˆ˜ì§‘
ğŸŒ ë‹¤êµ­ì–´ ìë™ ë²ˆì—­ ë° ì™¸êµ­ì¸ ì „ìš© í•™ìŠµ ê²½ë¡œ
ğŸ“„ êµìœ¡ ì´ìˆ˜ í™•ì¸ì„œ PDF ìë™ ìƒì„± (ë²•ì  íš¨ë ¥)
ğŸ¢ ë‹¤ì¤‘ í…Œë„ŒíŠ¸ ì§€ì› (íšŒì‚¬ë³„ ë…ë¦½ ìš´ì˜)

1.3. íƒ€ê²Ÿ ì‚¬ìš©ì
ì‚¬ìš©ì ìœ í˜•ì—­í• ì£¼ìš” ê¸°ëŠ¥ê´€ë¦¬ì (ADMIN)íšŒì‚¬ ëŒ€í‘œ, ì•ˆì „ê´€ë¦¬ìì˜ìƒ ë“±ë¡, êµìœ¡ ê³¼ì • ìƒì„±, íšŒì› ê´€ë¦¬, ì¦ë¹™ í™•ì¸ë³´ì¡° ê´€ë¦¬ì (SUB_ADMIN)í˜„ì¥ ì±…ì„ìêµìœ¡ ì‹¤ì‹œ, QR ìƒì„±, ì´ë ¥ ì¡°íšŒ (í¸ì§‘ ë¶ˆê°€)ì¼ë°˜ ì‚¬ìš©ì (USER)ê·¼ë¡œìêµìœ¡ ìˆ˜ê°•, ì¦ë¹™ ì œì¶œ
1.4. ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ êµ¬ë… ëª¨ë¸                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ê°œì¸ ê³„ì •: ì›” 9,900ì› (1ì¸ ì‚¬ìš©)          â”‚
â”‚ â€¢ íšŒì‚¬ ê³„ì •: ì—° 990,000ì› (ë¬´ì œí•œ íšŒì›)     â”‚
â”‚                                             â”‚
â”‚ ì¶”ê°€ ì˜µì…˜:                                  â”‚
â”‚ â€¢ AI ìë™ ë²ˆì—­: ì›” +50,000ì›                â”‚
â”‚ â€¢ ë§ì¶¤ ì˜ìƒ ì œì‘: ê±´ë‹¹ í˜‘ì˜                 â”‚
â”‚ â€¢ ì—”í„°í”„ë¼ì´ì¦ˆ: ë§ì¶¤ ê²¬ì                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. ê¸°ìˆ  ìŠ¤íƒ ë° ì•„í‚¤í…ì²˜
2.1. ê¸°ìˆ  ìŠ¤íƒ
yaml# Frontend
Framework: Next.js 15.0.0 (App Router)
Language: TypeScript 5.6.2
UI: Tailwind CSS 3.4+
State: React Query + Zustand
Node Editor: React Flow 11.10+

# Backend
Runtime: Next.js API Routes (Edge Runtime)
Language: TypeScript
ORM: Prisma 5.20+
Database: PostgreSQL 16+

# Authentication
Auth: NextAuth.js 5.0 (Beta)
Providers: Google, Kakao, Naver OAuth

# Video
Vimeo: oEmbed API (ë§í¬ ë°©ì‹)
Cloudflare: Stream API (ì—…ë¡œë“œ ë°©ì‹)
Player: Video.js 8.0 or Plyr.io 3.7

# Storage
Files: Cloudflare R2 (S3 Compatible)
Cache: Redis (Upstash)

# AI & Translation
STT: OpenAI Whisper API
Translation: OpenAI GPT-4 Turbo
Subtitles: SRT/VTT íŒŒì‹± (ìì²´ êµ¬í˜„)

# PDF Generation
Library: @react-pdf/renderer 3.4

# QR Code
Generation: qrcode.react 3.1
Scanning: jsQR (ëª¨ë°”ì¼)

# Deployment
Platform: Vercel (ê¶Œì¥) or AWS EC2 + PM2
CDN: Cloudflare
Monitoring: Sentry + Vercel Analytics
```

### 2.2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Users                            â”‚
â”‚  (PC ë¸Œë¼ìš°ì €)         (ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚
             â”‚ HTTPS              â”‚ HTTPS
             â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cloudflare (CDN + WAF)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Next.js 15 App (Vercel)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Pages (SSR/SSG)                     â”‚           â”‚
â”‚  â”‚  - Dashboard, Video Library          â”‚           â”‚
â”‚  â”‚  - Education Node Editor             â”‚           â”‚
â”‚  â”‚  - History, Settings                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  API Routes (Serverless)             â”‚           â”‚
â”‚  â”‚  - /api/auth/* (NextAuth.js)         â”‚           â”‚
â”‚  â”‚  - /api/videos/* (CRUD)              â”‚           â”‚
â”‚  â”‚  - /api/courses/* (Node Editor)      â”‚           â”‚
â”‚  â”‚  - /api/education/* (QR, ì¦ë¹™)       â”‚           â”‚
â”‚  â”‚  - /api/pdf/* (PDF ìƒì„±)             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
     â”‚   PostgreSQL   â”‚   â”‚    Redis    â”‚
     â”‚   (Supabase)   â”‚   â”‚  (Upstash)  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚     External Services              â”‚
     â”‚  â€¢ Vimeo (oEmbed API)              â”‚
     â”‚  â€¢ Cloudflare Stream               â”‚
     â”‚  â€¢ Cloudflare R2 (Storage)         â”‚
     â”‚  â€¢ OpenAI API (Whisper + GPT-4)    â”‚
     â”‚  â€¢ Email (Resend)                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
2.3. ë‹¤ì¤‘ í…Œë„ŒíŠ¸ ì•„í‚¤í…ì²˜ (PostgreSQL Schema ë°©ì‹)
sql-- Public Schema: í…Œë„ŒíŠ¸ ê´€ë¦¬
CREATE SCHEMA public;

-- íšŒì‚¬ (í…Œë„ŒíŠ¸) í…Œì´ë¸”
CREATE TABLE public.companies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) NOT NULL,
  domain VARCHAR(255) UNIQUE NOT NULL, -- abc.edu.com
  schema_name VARCHAR(63) UNIQUE NOT NULL, -- tenant_abc123
  logo_url TEXT,
  ip_ranges TEXT[], -- ["192.168.1.0/24"]
  subscription_plan VARCHAR(50) DEFAULT 'INDIVIDUAL',
  subscription_expires_at TIMESTAMP,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT NOW()
);

-- í…Œë„ŒíŠ¸ë³„ ë…ë¦½ ìŠ¤í‚¤ë§ˆ (ë™ì  ìƒì„±)
-- ì˜ˆ: tenant_abc123

CREATE SCHEMA tenant_abc123;

-- ì‚¬ìš©ì í…Œì´ë¸” (í…Œë„ŒíŠ¸ë³„)
CREATE TABLE tenant_abc123.users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  phone VARCHAR(20),
  role VARCHAR(20) DEFAULT 'USER', -- ADMIN, SUB_ADMIN, USER
  -- ... (ìƒì„¸ ìŠ¤í‚¤ë§ˆëŠ” 3ì¥ ì°¸ì¡°)
);
ìŠ¤í‚¤ë§ˆ ê²©ë¦¬ ì¥ì :

âœ… ì™„ë²½í•œ ë°ì´í„° ê²©ë¦¬ (íšŒì‚¬ ê°„ ë°ì´í„° ìœ ì¶œ ë¶ˆê°€ëŠ¥)
âœ… í…Œë„ŒíŠ¸ë³„ ë°±ì—…/ë³µì› ê°€ëŠ¥
âœ… ì„±ëŠ¥ ìµœì í™” (ì¸ë±ìŠ¤ ë…ë¦½ ê´€ë¦¬)
âœ… í™•ì¥ì„± (ìƒ¤ë”© ìš©ì´)

Prisma ì„¤ì •:
prismagenerator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "tenant_abc123", "tenant_xyz789"]
}
```

---

## 3. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 3.1. ERD (Entity Relationship Diagram)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    companies    â”‚ (Public Schema)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚
â”‚ name            â”‚
â”‚ schema_name     â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚ subscription    â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                           â”‚
        Tenant Schema      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚      users      â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚ id (PK)         â”‚        â”‚
â”‚ email           â”‚        â”‚
â”‚ role            â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
         â”‚                 â”‚
         â”‚ 1:N             â”‚
         â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ education_coursesâ”‚       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚ id (PK)         â”‚        â”‚
â”‚ owner_id (FK)   â”‚        â”‚
â”‚ nodes (JSON)    â”‚        â”‚
â”‚ edges (JSON)    â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
         â”‚                 â”‚
         â”‚ 1:N             â”‚
         â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ education_histories â”‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ id (PK)             â”‚    â”‚
â”‚ course_id (FK)      â”‚    â”‚
â”‚ attendees (JSON)    â”‚    â”‚
â”‚ certificate_url     â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     videos      â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚ id (PK)         â”‚        â”‚
â”‚ provider        â”‚        â”‚
â”‚ provider_id     â”‚        â”‚
â”‚ subtitles (JSON)â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    sessions     â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚ id (PK)         â”‚        â”‚
â”‚ user_id (FK)    â”‚        â”‚
â”‚ ip_address      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”˜ (IP ì ‘ê·¼ ì œì–´)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
3.2. Prisma Schema (ì „ì²´)
prisma// ===== Public Schema =====

model Company {
  id                    String   @id @default(uuid())
  name                  String
  domain                String   @unique
  schemaName            String   @unique @map("schema_name")
  logoUrl               String?  @map("logo_url")
  ipRanges              String[] @map("ip_ranges")
  subscriptionPlan      SubscriptionPlan @default(INDIVIDUAL) @map("subscription_plan")
  subscriptionExpiresAt DateTime? @map("subscription_expires_at")
  isActive              Boolean  @default(true) @map("is_active")
  createdAt             DateTime @default(now()) @map("created_at")
  
  @@map("companies")
  @@schema("public")
}

enum SubscriptionPlan {
  INDIVIDUAL  // ê°œì¸
  COMPANY     // íšŒì‚¬
  
  @@schema("public")
}

// ===== Tenant Schema (Example: tenant_abc123) =====

model User {
  id                  String   @id @default(uuid())
  email               String   @unique
  name                String
  phone               String?
  companyName         String?  @map("company_name")
  siteName            String?  @map("site_name")
  industry            Industry?
  
  // OAuth
  provider            String?  // "google", "kakao", "naver"
  providerId          String?  @map("provider_id")
  passwordHash        String?  @map("password_hash")
  
  // ì—­í•  ë° ê¶Œí•œ
  role                UserRole @default(USER)
  isActive            Boolean  @default(true) @map("is_active")
  
  // ì„¤ì •
  preferredLanguages  String[] @default(["ko"]) @map("preferred_languages")
  notificationEmail   String?  @map("notification_email")
  emailNotification   Boolean  @default(false) @map("email_notification")
  
  // Relations
  sessions            Session[]
  ownedCourses        EducationCourse[]
  executedHistories   EducationHistory[] @relation("ExecutedBy")
  
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  
  @@map("users")
  @@schema("tenant_abc123")
}

enum UserRole {
  ADMIN       // ìµœê³  ê´€ë¦¬ì (ëª¨ë“  ê¶Œí•œ)
  SUB_ADMIN   // ë³´ì¡° ê´€ë¦¬ì (êµìœ¡ ì‹¤ì‹œ, ì¡°íšŒë§Œ)
  USER        // ì¼ë°˜ ì‚¬ìš©ì (êµìœ¡ ìˆ˜ê°•)
  WITHDRAWN   // íƒˆí‡´
  
  @@schema("tenant_abc123")
}

enum Industry {
  CONSTRUCTION   // ê±´ì„¤ì—…
  MANUFACTURING  // ì œì¡°ì—…
  LOGISTICS      // ë¬¼ë¥˜/ìš´ì†¡
  FOOD           // ì‹ìŒë£Œ
  CHEMICAL       // í™”í•™
  ELECTRICITY    // ì „ê¸°/ì „ì
  SERVICE        // ì„œë¹„ìŠ¤ì—…
  ETC            // ê¸°íƒ€
  
  @@schema("tenant_abc123")
}

model Session {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  ipAddress String   @unique @map("ip_address")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  
  createdAt DateTime @default(now()) @map("created_at")
  
  @@map("sessions")
  @@schema("tenant_abc123")
}

// ===== ì˜ìƒ ê´€ë¦¬ =====

model Video {
  id              String   @id @default(uuid())
  title           String
  description     String?
  duration        Int      // ì´ˆ ë‹¨ìœ„
  thumbnailUrl    String   @map("thumbnail_url")
  
  // ì˜ìƒ ì œê³µì
  provider        VideoProvider
  providerId      String   @map("provider_id")
  videoUrl        String   @map("video_url")
  embedHtml       String?  @map("embed_html")
  
  // ë¶„ë¥˜
  category        String[] @default([])
  industry        Industry[]
  
  // ë‹¤êµ­ì–´ ìë§‰
  hasKoreanAudio  Boolean  @default(true) @map("has_korean_audio")
  subtitles       Json?    // SubtitleTrack[]
  aiTranslation   Boolean  @default(false) @map("ai_translation")
  
  // ì†Œìœ  ë° ê³µê°œ
  uploadedBy      String   @map("uploaded_by")
  isPublic        Boolean  @default(true) @map("is_public")
  
  // í†µê³„
  viewCount       Int      @default(0) @map("view_count")
  usedInCourses   Int      @default(0) @map("used_in_courses")
  
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  @@index([provider, providerId])
  @@index([industry])
  @@map("videos")
  @@schema("tenant_abc123")
}

enum VideoProvider {
  VIMEO
  CLOUDFLARE
  
  @@schema("tenant_abc123")
}

// ===== êµìœ¡ ê³¼ì • =====

model EducationCourse {
  id            String   @id @default(uuid())
  title         String
  description   String?
  thumbnail     String?
  
  // ë…¸ë“œ êµ¬ì¡°
  nodes         Json     // EducationNode[]
  edges         Json     // EducationEdge[]
  
  totalDuration Int      @default(0) @map("total_duration")
  
  // ì†Œìœ  ë° ê³µìœ 
  ownerId       String   @map("owner_id")
  owner         User     @relation(fields: [ownerId], references: [id])
  
  isPublic      Boolean  @default(false) @map("is_public")
  sharedWith    String[] @default([]) @map("shared_with")
  
  // í†µê³„
  viewCount     Int      @default(0) @map("view_count")
  usedCount     Int      @default(0) @map("used_count")
  
  // Relations
  histories     EducationHistory[]
  
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  @@index([ownerId])
  @@map("education_courses")
  @@schema("tenant_abc123")
}

// ===== êµìœ¡ ì´ë ¥ =====

model EducationHistory {
  id                  String   @id @default(uuid())
  
  // êµìœ¡ ê³¼ì • ì°¸ì¡°
  courseId            String   @map("course_id")
  course              EducationCourse @relation(fields: [courseId], references: [id])
  courseTitleSnapshot String   @map("course_title_snapshot")
  
  // ì‹¤í–‰ ì •ë³´
  startedAt           DateTime @map("started_at")
  completedAt         DateTime? @map("completed_at")
  totalAttendees      Int      @map("total_attendees")
  
  // ì°¸ì„ì ë°ì´í„° (JSON)
  attendees           Json     // Attendee[]
  byNationality       Json?    @map("by_nationality") // { "KO": 12, "VN": 3 }
  
  // PDF ì¦ë¹™
  certificateUrl      String?  @map("certificate_url")
  screenshots         String[] @default([]) // êµìœ¡ í™”ë©´ ìº¡ì²˜
  
  // QR ì„¤ì •
  qrTokenExpiry       Int      @default(30) @map("qr_token_expiry") // ë¶„ ë‹¨ìœ„
  
  // ì‹¤í–‰ì
  executedBy          String   @map("executed_by")
  executor            User     @relation("ExecutedBy", fields: [executedBy], references: [id])
  
  createdAt           DateTime @default(now()) @map("created_at")
  
  @@index([courseId])
  @@index([executedBy, completedAt])
  @@map("education_histories")
  @@schema("tenant_abc123")
}

// ===== ì„¤ì • =====

model SystemSetting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt @map("updated_at")
  
  @@map("system_settings")
  @@schema("tenant_abc123")
}
3.3. JSON í•„ë“œ ìƒì„¸ ìŠ¤í‚¤ë§ˆ
SubtitleTrack (ìë§‰)
typescriptinterface SubtitleTrack {
  language: string;    // "en", "vi", "zh", "th"
  label: string;       // "English", "Tiáº¿ng Viá»‡t"
  url: string;         // Cloudflare R2 URL
  format: "srt" | "vtt";
  source: "MANUAL" | "AI"; // ìˆ˜ë™ ì—…ë¡œë“œ or AI ìƒì„±
  createdAt: string;   // ISO 8601
}
EducationNode (êµìœ¡ ë…¸ë“œ)
typescriptinterface EducationNode {
  id: string;
  type: "START" | "VIDEO" | "IMAGE" | "PDF" | "END";
  position: { x: number; y: number };
  data: {
    videoId?: string;       // VIDEO íƒ€ì…
    imageUrl?: string;      // IMAGE íƒ€ì…
    pdfUrl?: string;        // PDF íƒ€ì…
    duration?: number;      // ì¬ìƒ ì‹œê°„ (ì´ˆ)
    title?: string;
    description?: string;
  };
}
EducationEdge (ë…¸ë“œ ì—°ê²°)
typescriptinterface EducationEdge {
  id: string;
  source: string;  // ì¶œë°œ ë…¸ë“œ ID
  target: string;  // ë„ì°© ë…¸ë“œ ID
  type?: "default" | "smooth";
}
Attendee (ì°¸ì„ì)
typescriptinterface Attendee {
  id: string;
  name: string;
  nationality: string;     // "KO", "EN", "VN", "TH"
  language: string;        // ì„ íƒí•œ ì–¸ì–´
  signatureUrl: string;    // ì „ì ì„œëª… ì´ë¯¸ì§€ (R2 URL)
  selfieUrl: string;       // ì…€ì¹´ ì´ë¯¸ì§€ (R2 URL)
  gpsLatitude?: number;    // GPS ìœ„ë„
  gpsLongitude?: number;   // GPS ê²½ë„
  completedAt: string;     // ISO 8601
  deviceType: "PC" | "MOBILE";
  consentGiven: boolean;   // ê°œì¸ì •ë³´ ë™ì˜
  consentAt: string;       // ë™ì˜ ì‹œê°„
}

4. í•µì‹¬ ê¸°ëŠ¥ ëª…ì„¸
4.1. íšŒì›ê°€ì… ë° ì¸ì¦
4.1.1. ì†Œì…œ ë¡œê·¸ì¸ (OAuth)
ì§€ì› ì œê³µì:

Google OAuth 2.0
Kakao Login API
Naver Login API

NextAuth.js ì„¤ì •:
typescript// app/api/auth/[...nextauth]/route.ts

import NextAuth from "next-auth";
import GoogleProvider from "next-auth/providers/google";
import KakaoProvider from "next-auth/providers/kakao";
import NaverProvider from "next-auth/providers/naver";

export const authOptions = {
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
    KakaoProvider({
      clientId: process.env.KAKAO_CLIENT_ID!,
      clientSecret: process.env.KAKAO_CLIENT_SECRET!,
    }),
    NaverProvider({
      clientId: process.env.NAVER_CLIENT_ID!,
      clientSecret: process.env.NAVER_CLIENT_SECRET!,
    }),
  ],
  callbacks: {
    async signIn({ user, account, profile }) {
      // íšŒì›ê°€ì… ì¶”ê°€ ì •ë³´ ì…ë ¥ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
      return true;
    },
    async session({ session, token }) {
      session.user.id = token.sub;
      return session;
    },
  },
  pages: {
    signIn: '/auth/signin',
    signUp: '/auth/signup',
    error: '/auth/error',
  },
};

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };
4.1.2. íšŒì›ê°€ì… í¼
í•„ìˆ˜ ì…ë ¥ í•­ëª©:
typescriptinterface SignUpForm {
  // OAuthì—ì„œ ìë™ ìˆ˜ì§‘
  email: string;           // example@company.com
  provider: string;        // "google", "kakao", "naver"
  providerId: string;
  
  // ì‚¬ìš©ì ì…ë ¥
  name: string;            // ì‹¤ëª…
  phone: string;           // 010-1234-5678
  companyName: string;     // íšŒì‚¬ëª…
  siteName?: string;       // í˜„ì¥ëª… (ì„ íƒ)
  industry: Industry;      // ì—…ì¢… ë“œë¡­ë‹¤ìš´
  
  // ê³„ì • ìœ í˜•
  accountType: "INDIVIDUAL" | "COMPANY";
}
ì—…ì¢… ë¶„ë¥˜ (ì¶”ì²œ ì˜ìƒìš©):
typescriptconst INDUSTRIES = [
  { value: "CONSTRUCTION", label: "ê±´ì„¤ì—…", icon: "ğŸ—ï¸" },
  { value: "MANUFACTURING", label: "ì œì¡°ì—…", icon: "ğŸ­" },
  { value: "LOGISTICS", label: "ë¬¼ë¥˜/ìš´ì†¡", icon: "ğŸšš" },
  { value: "FOOD", label: "ì‹ìŒë£Œ", icon: "ğŸ”" },
  { value: "CHEMICAL", label: "í™”í•™", icon: "âš—ï¸" },
  { value: "ELECTRICITY", label: "ì „ê¸°/ì „ì", icon: "âš¡" },
  { value: "SERVICE", label: "ì„œë¹„ìŠ¤ì—…", icon: "ğŸ’¼" },
  { value: "ETC", label: "ê¸°íƒ€", icon: "ğŸ“‹" },
];

#### íšŒì›ê°€ì… í¼ ê²€ì¦ ê·œì¹™

**ì´ë©”ì¼ (ì•„ì´ë””)**
- **ì¤‘ë³µ í™•ì¸ í•„ìˆ˜**: íšŒì›ê°€ì… ì „ ë°˜ë“œì‹œ ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ ë²„íŠ¼ í´ë¦­
- ì¤‘ë³µ í™•ì¸ API í˜¸ì¶œ: `GET /api/auth/check-email?email={email}`
- ì´ë©”ì¼ í˜•ì‹ ê²€ì¦: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`
- ì¤‘ë³µ í™•ì¸ ì™„ë£Œ í›„ ì´ë©”ì¼ ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
- ì¤‘ë³µ í™•ì¸ ë²„íŠ¼ ìƒíƒœ: "ì¤‘ë³µ í™•ì¸" â†’ "í™•ì¸ ì™„ë£Œ"

typescript// ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ ë¡œì§
const checkEmailDuplicate = async () => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if (!emailRegex.test(formData.email)) {
    setErrors({ ...errors, email: "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤" });
    return;
  }

  const response = await fetch(
    `/api/auth/check-email?email=${encodeURIComponent(formData.email)}`
  );

  const data = await response.json();

  if (data.available) {
    setEmailAvailable(true);
    setEmailChecked(true);
    alert("ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
  } else {
    setErrors({ ...errors, email: "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤" });
  }
};


**íœ´ëŒ€ì „í™”ë²ˆí˜¸**
- **í˜•ì‹**: 3ìë¦¬ - 4ìë¦¬ - 4ìë¦¬ (ì˜ˆ: 010-1234-5678)
- **3ê°œ ì…ë ¥ í•„ë“œë¡œ ë¶„ë¦¬**: phone1 (3ìë¦¬), phone2 (4ìë¦¬), phone3 (4ìë¦¬)
- **ìë™ í¬ì»¤ìŠ¤ ì´ë™**:
  - phone1ì— 3ìë¦¬ ì…ë ¥ ì™„ë£Œ â†’ phone2ë¡œ ìë™ ì´ë™
  - phone2ì— 4ìë¦¬ ì…ë ¥ ì™„ë£Œ â†’ phone3ë¡œ ìë™ ì´ë™
  - phone3ì€ ë§ˆì§€ë§‰ í•„ë“œì´ë¯€ë¡œ ìë™ ì´ë™ ì—†ìŒ
- **ì…ë ¥ ì œí•œ**: ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥ (`replace(/[^0-9]/g, "")`)

typescript// íœ´ëŒ€ì „í™”ë²ˆí˜¸ ìë™ í¬ì»¤ìŠ¤ êµ¬í˜„
const phone2Ref = useRef<HTMLInputElement>(null);
const phone3Ref = useRef<HTMLInputElement>(null);

const handlePhoneChange = (
  field: "phone1" | "phone2" | "phone3",
  value: string
) => {
  const numericValue = value.replace(/[^0-9]/g, "");
  setFormData({ ...formData, [field]: numericValue });

  // ìë™ í¬ì»¤ìŠ¤ ì´ë™
  if (field === "phone1" && numericValue.length === 3) {
    phone2Ref.current?.focus();
  } else if (field === "phone2" && numericValue.length === 4) {
    phone3Ref.current?.focus();
  }
};

// JSX êµ¬ì¡°
<div className="flex gap-2">
  <input
    type="text"
    maxLength={3}
    value={formData.phone1}
    onChange={(e) => handlePhoneChange("phone1", e.target.value)}
    placeholder="010"
  />
  <span>-</span>
  <input
    ref={phone2Ref}
    type="text"
    maxLength={4}
    value={formData.phone2}
    onChange={(e) => handlePhoneChange("phone2", e.target.value)}
    placeholder="1234"
  />
  <span>-</span>
  <input
    ref={phone3Ref}
    type="text"
    maxLength={4}
    value={formData.phone3}
    onChange={(e) => handlePhoneChange("phone3", e.target.value)}
    placeholder="5678"
  />
</div>


**ë¹„ë°€ë²ˆí˜¸**
- **ìµœì†Œ ê¸¸ì´**: 6ì ì´ìƒ
- **íŠ¹ìˆ˜ë¬¸ì í•„ìˆ˜ í¬í•¨**: `!@#$%^&*(),.?":{}|<>` ì¤‘ 1ê°œ ì´ìƒ
- **ì‹¤ì‹œê°„ ê²€ì¦**: ì…ë ¥ ì¤‘ ì¡°ê±´ ì¶©ì¡± ì—¬ë¶€ ì‹œê°ì  í”¼ë“œë°± ì œê³µ
- **ë¹„ë°€ë²ˆí˜¸ í™•ì¸**: ì¬ì…ë ¥ í•„ë“œì™€ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸

typescript// ë¹„ë°€ë²ˆí˜¸ ì‹¤ì‹œê°„ ê²€ì¦
const [passwordValid, setPasswordValid] = useState(false);
const [passwordMatch, setPasswordMatch] = useState(false);

useEffect(() => {
  const hasMinLength = formData.password.length >= 6;
  const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(formData.password);
  setPasswordValid(hasMinLength && hasSpecialChar);
}, [formData.password]);

useEffect(() => {
  if (formData.passwordConfirm) {
    setPasswordMatch(formData.password === formData.passwordConfirm);
  }
}, [formData.password, formData.passwordConfirm]);

// ì‹œê°ì  í”¼ë“œë°±
<div className="text-sm mt-1">
  <p className={passwordValid ? "text-green-600" : "text-gray-500"}>
    {passwordValid ? "âœ“" : "â—‹"} 6ì ì´ìƒ, íŠ¹ìˆ˜ë¬¸ì í¬í•¨
  </p>
  <p className={passwordMatch ? "text-green-600" : "text-gray-500"}>
    {passwordMatch ? "âœ“" : "â—‹"} ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜
  </p>
</div>


**íšŒì›ê°€ì… API ê²€ì¦**

typescript// POST /api/auth/signup

export async function POST(request: NextRequest) {
  const body = await request.json();
  const {
    email,
    password,
    name,
    phone, // "010-1234-5678" í˜•ì‹
    companyName,
    siteName,
    industry,
    accountType,
  } = body;

  // 1. í•„ìˆ˜ í•„ë“œ ê²€ì¦
  if (!email || !password || !name || !phone || !companyName || !industry || !accountType) {
    return NextResponse.json(
      { error: "í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”" },
      { status: 400 }
    );
  }

  // 2. ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    return NextResponse.json(
      { error: "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤" },
      { status: 400 }
    );
  }

  // 3. ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (6ì ì´ìƒ, íŠ¹ìˆ˜ë¬¸ì í¬í•¨)
  if (password.length < 6) {
    return NextResponse.json(
      { error: "ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤" },
      { status: 400 }
    );
  }

  const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
  if (!hasSpecialChar) {
    return NextResponse.json(
      { error: "ë¹„ë°€ë²ˆí˜¸ëŠ” íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤" },
      { status: 400 }
    );
  }

  // 4. íœ´ëŒ€ì „í™”ë²ˆí˜¸ í˜•ì‹ ê²€ì¦ (010-1234-5678)
  const phoneRegex = /^\d{3}-\d{4}-\d{4}$/;
  if (!phoneRegex.test(phone)) {
    return NextResponse.json(
      { error: "íœ´ëŒ€ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤ (ì˜ˆ: 010-1234-5678)" },
      { status: 400 }
    );
  }

  // 5. ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
  const existingUser = await prisma.user.findUnique({
    where: { email },
  });

  if (existingUser) {
    return NextResponse.json(
      { error: "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤" },
      { status: 409 }
    );
  }

  // 6. ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
  const passwordHash = await bcrypt.hash(password, 12);

  // 7. ì‚¬ìš©ì ìƒì„±
  const user = await prisma.user.create({
    data: {
      email,
      passwordHash,
      name,
      phone,
      companyName,
      siteName,
      industry,
      role: 'ADMIN', // ì²« ê°€ì…ìëŠ” ê´€ë¦¬ì
      provider: 'credentials',
      isActive: true,
    },
  });

  // 8. ë¬´ë£Œ ì²´í—˜ ê¸°ê°„ ë¶€ì—¬ (14ì¼)
  const trialEndDate = new Date();
  trialEndDate.setDate(trialEndDate.getDate() + 14);

  await prisma.subscription.create({
    data: {
      userId: user.id,
      planType: accountType,
      status: 'TRIAL',
      startedAt: new Date(),
      trialEndsAt: trialEndDate,
    },
  });

  await prisma.freeTrial.create({
    data: {
      userId: user.id,
      planType: accountType,
      startDate: new Date(),
      endDate: trialEndDate,
      status: 'ACTIVE',
    },
  });

  return NextResponse.json({
    success: true,
    message: "íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
  });
}


**ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ API**

typescript// GET /api/auth/check-email?email={email}

export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url);
  const email = searchParams.get("email");

  if (!email) {
    return NextResponse.json(
      { error: "ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" },
      { status: 400 }
    );
  }

  // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    return NextResponse.json(
      { error: "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤" },
      { status: 400 }
    );
  }

  // ì¤‘ë³µ í™•ì¸
  const existingUser = await prisma.user.findUnique({
    where: { email },
  });

  return NextResponse.json({
    available: !existingUser,
    email,
  });
}


**ì—ëŸ¬ ë©”ì‹œì§€ í‘œì¤€**
- ì´ë©”ì¼ í˜•ì‹ ì˜¤ë¥˜: "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤"
- ì´ë©”ì¼ ì¤‘ë³µ: "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤"
- ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´: "ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤"
- ë¹„ë°€ë²ˆí˜¸ íŠ¹ìˆ˜ë¬¸ì: "ë¹„ë°€ë²ˆí˜¸ëŠ” íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤"
- ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜: "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
- íœ´ëŒ€ì „í™” í˜•ì‹: "íœ´ëŒ€ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤ (ì˜ˆ: 010-1234-5678)"
- í•„ìˆ˜ í•­ëª© ëˆ„ë½: "í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”"

4.1.3. IP ê¸°ë°˜ ë™ì‹œ ì ‘ì† ì œì–´
ëª©ì : ê³„ì • ê³µìœ  ë°©ì§€ (1 ê³„ì • = 1 IP ë™ì‹œ ì ‘ì†)
ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤:
typescript// app/api/auth/login/route.ts

export async function POST(request: Request) {
  const { email, provider } = await request.json();
  const clientIp = request.headers.get('x-forwarded-for') || request.ip;
  
  // 1. ì‚¬ìš©ì ì¸ì¦
  const user = await prisma.user.findUnique({ where: { email } });
  
  // 2. ê¸°ì¡´ ì„¸ì…˜ í™•ì¸
  const existingSession = await prisma.session.findFirst({
    where: { userId: user.id, ipAddress: { not: clientIp } }
  });
  
  if (existingSession) {
    // 3. ë‹¤ë¥¸ IPì—ì„œ ë¡œê·¸ì¸ ì¤‘ â†’ ê¸°ì¡´ ì„¸ì…˜ ì¢…ë£Œ
    await prisma.session.delete({ where: { id: existingSession.id } });
  }
  
  // 4. ìƒˆ ì„¸ì…˜ ìƒì„±
  const token = generateJWT({ userId: user.id, tenantId: user.tenantId });
  
  await prisma.session.create({
    data: {
      userId: user.id,
      ipAddress: clientIp,
      token,
      expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24ì‹œê°„
    },
  });
  
  return NextResponse.json({ token });
}
```

---

## 5. ì˜ìƒ ì œê³µì ëª¨ë“ˆ ì‹œìŠ¤í…œ

### 5.1. ì˜ìƒ ì œê³µì ì„ íƒ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Video Provider Module             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Vimeo     â”‚   â”‚  Cloudflare  â”‚  â”‚
â”‚  â”‚  Provider   â”‚   â”‚   Provider   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â–²                 â–²           â”‚
â”‚         â”‚                 â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                   â”‚                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚         â”‚  Provider Factory â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                   â–²                   â”‚
â”‚                   â”‚                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚         â”‚  Video Interface  â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
5.2. Vimeo Provider (ë§í¬ ë°©ì‹)
5.2.1. Vimeo ì˜ìƒ ë“±ë¡ í”„ë¡œì„¸ìŠ¤
mermaidsequenceDiagram
    participant A as ê´€ë¦¬ì
    participant V as Vimeo.com
    participant P as í”Œë«í¼
    participant DB as Database
    
    A->>V: 1. ì˜ìƒ ì—…ë¡œë“œ
    V-->>A: 2. ê³µìœ  URL ìƒì„±
    A->>P: 3. Vimeo URL ì…ë ¥
    P->>V: 4. oEmbed API í˜¸ì¶œ
    V-->>P: 5. ë©”íƒ€ë°ì´í„° ë°˜í™˜
    P-->>A: 6. ìë™ ì…ë ¥ (ì œëª©, ì¸ë„¤ì¼)
    A->>P: 7. ì¶”ê°€ ì •ë³´ ì…ë ¥ + ë“±ë¡
    P->>DB: 8. ì˜ìƒ ì •ë³´ ì €ì¥
5.2.2. Vimeo oEmbed API ì—°ë™
typescript// app/lib/video-providers/vimeo-provider.ts

export class VimeoProvider implements VideoProvider {
  type = VideoProviderType.VIMEO;
  
  async extractMetadata(url: string): Promise<VideoMetadata> {
    // 1. URL ê²€ì¦
    const regex = /vimeo\.com\/(\d+)/;
    const match = url.match(regex);
    
    if (!match) {
      throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ Vimeo URLì…ë‹ˆë‹¤');
    }
    
    const videoId = match[1];
    
    // 2. oEmbed API í˜¸ì¶œ (ë¬´ë£Œ, ì¸ì¦ ë¶ˆí•„ìš”)
    const oembedUrl = `https://vimeo.com/api/oembed.json?url=${encodeURIComponent(url)}`;
    const response = await fetch(oembedUrl);
    
    if (!response.ok) {
      throw new Error('Vimeo ë©”íƒ€ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    }
    
    const data = await response.json();
    
    // 3. ë©”íƒ€ë°ì´í„° ë§¤í•‘
    return {
      providerId: videoId,
      title: data.title,
      duration: data.duration,
      thumbnailUrl: data.thumbnail_url,
      author: data.author_name,
      embedHtml: data.html,
      width: data.width,
      height: data.height,
    };
  }
  
  getPlayerUrl(providerId: string, options?: PlayerOptions): string {
    const params = new URLSearchParams();
    
    if (options?.autoplay) params.set('autoplay', '1');
    if (options?.loop) params.set('loop', '1');
    if (options?.muted) params.set('muted', '1');
    if (options?.language) params.set('texttrack', options.language);
    
    return `https://player.vimeo.com/video/${providerId}?${params.toString()}`;
  }
  
  getEmbedHtml(providerId: string, options?: EmbedOptions): string {
    const playerUrl = this.getPlayerUrl(providerId, options);
    
    return `
      <iframe 
        src="${playerUrl}"
        width="${options?.width || '100%'}"
        height="${options?.height || '100%'}"
        frameborder="0"
        allow="autoplay; fullscreen; picture-in-picture"
        allowfullscreen
      ></iframe>
    `;
  }
}
Vimeo API ì‚¬ìš© ì œí•œ:

âœ… oEmbed API: ë¬´ë£Œ, ì¸ì¦ ë¶ˆí•„ìš”, ë¬´ì œí•œ
âŒ ì§ì ‘ ì—…ë¡œë“œ: Pro ì´ìƒ ê³„ì • í•„ìš” ($20/ì›”)
âœ… Player API: ë¬´ë£Œ, ì¬ìƒ ì œì–´ ê°€ëŠ¥

5.3. Cloudflare Stream Provider
5.3.1. Cloudflare Stream ì—…ë¡œë“œ ë°©ì‹
ë°©ë²• 1: íŒŒì¼ ì§ì ‘ ì—…ë¡œë“œ
typescriptasync uploadVideo(file: File): Promise<VideoMetadata> {
  const formData = new FormData();
  formData.append('file', file);
  
  const response = await fetch(
    `https://api.cloudflare.com/client/v4/accounts/${ACCOUNT_ID}/stream`,
    {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${API_TOKEN}`,
      },
      body: formData,
    }
  );
  
  const data = await response.json();
  
  return {
    providerId: data.result.uid,
    title: file.name,
    duration: data.result.duration,
    thumbnailUrl: data.result.thumbnail,
  };
}
ë°©ë²• 2: URL ì…ë ¥
typescriptasync extractMetadata(url: string): Promise<VideoMetadata> {
  // Cloudflare Stream URL íŒŒì‹±
  const regex = /cloudflarestream\.com\/([a-f0-9]+)/;
  const match = url.match(regex);
  
  if (!match) {
    throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ Cloudflare Stream URLì…ë‹ˆë‹¤');
  }
  
  const uid = match[1];
  
  // Cloudflare APIë¡œ ë©”íƒ€ë°ì´í„° ì¡°íšŒ
  const response = await fetch(
    `https://api.cloudflare.com/client/v4/accounts/${ACCOUNT_ID}/stream/${uid}`,
    {
      headers: { 'Authorization': `Bearer ${API_TOKEN}` },
    }
  );
  
  const data = await response.json();
  
  return {
    providerId: uid,
    title: data.result.meta?.name || 'Untitled',
    duration: data.result.duration,
    thumbnailUrl: data.result.thumbnail,
  };
}
Cloudflare Stream ê°€ê²©:

ì €ì¥: $5/1,000ë¶„
ì¬ìƒ: $1/1,000ë¶„

5.4. Provider Factory
typescript// app/lib/video-providers/provider-factory.ts

import { VimeoProvider } from './vimeo-provider';
import { CloudflareProvider } from './cloudflare-provider';

export function createVideoProvider(type: VideoProviderType): VideoProvider {
  switch (type) {
    case VideoProviderType.VIMEO:
      return new VimeoProvider();
    case VideoProviderType.CLOUDFLARE:
      return new CloudflareProvider();
    default:
      throw new Error(`ì§€ì›í•˜ì§€ ì•ŠëŠ” ì œê³µì: ${type}`);
  }
}
5.5. ì˜ìƒ ë“±ë¡ API
typescript// app/api/videos/route.ts

export async function POST(request: Request) {
  const session = await getServerSession();
  if (!session?.user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  
  const {
    provider,      // "VIMEO" or "CLOUDFLARE"
    videoUrl,      // Vimeo/Cloudflare URL
    file,          // Cloudflare íŒŒì¼ ì—…ë¡œë“œ ì‹œ
    title,
    description,
    industry,
    category,
    subtitles,
    aiTranslation,
    isPublic,
  } = await request.json();
  
  // 1. Provider ì„ íƒ
  const videoProvider = createVideoProvider(provider);
  
  // 2. ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
  let metadata: VideoMetadata;
  
  if (file && provider === 'CLOUDFLARE') {
    metadata = await videoProvider.uploadVideo(file);
  } else {
    metadata = await videoProvider.extractMetadata(videoUrl);
  }
  
  // 3. DB ì €ì¥
  const video = await prisma.video.create({
    data: {
      title: title || metadata.title,
      description,
      duration: metadata.duration,
      thumbnailUrl: metadata.thumbnailUrl,
      provider,
      providerId: metadata.providerId,
      videoUrl: videoUrl || '',
      embedHtml: metadata.embedHtml,
      industry,
      category,
      subtitles,
      aiTranslation,
      uploadedBy: session.user.id,
      isPublic,
    },
  });
  
  return NextResponse.json(video);
}

6. êµìœ¡ ì¡°í•© ë…¸ë“œ ì—ë””í„°
6.1. React Flow ê¸°ë°˜ ë…¸ë“œ ì—ë””í„°
6.1.1. ë…¸ë“œ íƒ€ì… ì •ì˜
typescript// app/types/education-node.ts

export enum NodeType {
  START = "START",     // ì‹œì‘ì 
  VIDEO = "VIDEO",     // ì˜ìƒ
  IMAGE = "IMAGE",     // ì´ë¯¸ì§€ (í‘œì§€, ì¤‘ê°„)
  PDF = "PDF",         // PDF ë¬¸ì„œ
  END = "END"          // ì¢…ë£Œì 
}

export interface EducationNode {
  id: string;
  type: NodeType;
  position: { x: number; y: number };
  data: {
    videoId?: string;       // VIDEO íƒ€ì…
    videoTitle?: string;
    videoDuration?: number;
    videoThumbnail?: string;
    
    imageUrl?: string;      // IMAGE íƒ€ì…
    imageTitle?: string;
    
    pdfUrl?: string;        // PDF íƒ€ì…
    pdfTitle?: string;
    
    title?: string;
    description?: string;
  };
}

export interface EducationEdge {
  id: string;
  source: string;
  target: string;
  type?: "default" | "smooth" | "step";
  animated?: boolean;
}
```

#### 6.1.2. ë…¸ë“œ ì—ë””í„° UI êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‚´ êµìœ¡ ë§Œë“¤ê¸°                                           â”‚
â”‚ êµìœ¡ëª…: [___________________________] [ì €ì¥] [ë¯¸ë¦¬ë³´ê¸°]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                                          â”‚
â”‚ ğŸ” ê²€ìƒ‰      â”‚         [ì‹œì‘]                           â”‚
â”‚ [________]   â”‚           â”‚                              â”‚
â”‚              â”‚           â–¼                              â”‚
â”‚ ì˜ìƒ ë¦¬ìŠ¤íŠ¸  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚     â”‚ í‘œì§€ì´ë¯¸ì§€ â”‚                         â”‚
â”‚ â”‚í¬í¬ë¦¬í”„íŠ¸ â”‚â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚
â”‚ â”‚10:20     â”‚â”‚           â”‚                              â”‚
â”‚ â”‚[+ì¶”ê°€]   â”‚â”‚           â–¼                              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚     â”‚ ì˜ìƒ 1   â”‚                         â”‚
â”‚ â”‚ì „ê¸°ì•ˆì „  â”‚â”‚     â”‚ 10:20    â”‚                         â”‚
â”‚ â”‚08:45     â”‚â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚
â”‚ â”‚[+ì¶”ê°€]   â”‚â”‚           â”‚                              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚           â–¼                              â”‚
â”‚              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚ [ë‚´ ì˜ìƒ]    â”‚     â”‚ì¤‘ê°„ PDF  â”‚                         â”‚
â”‚ [ì—…ë¡œë“œ]     â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚
â”‚              â”‚           â”‚                              â”‚
â”‚ [ì´ë¯¸ì§€]     â”‚           â–¼                              â”‚
â”‚ [ì—…ë¡œë“œ]     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚     â”‚ ì˜ìƒ 2   â”‚                         â”‚
â”‚ [PDF]        â”‚     â”‚ 15:10    â”‚                         â”‚
â”‚ [ì—…ë¡œë“œ]     â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                         â”‚
â”‚              â”‚           â”‚                              â”‚
â”‚              â”‚           â–¼                              â”‚
â”‚              â”‚        [ì¢…ë£Œ]                            â”‚
â”‚              â”‚                                          â”‚
â”‚              â”‚ ì´ ì‹œê°„: 25ë¶„ 30ì´ˆ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
6.1.3. React Flow êµ¬í˜„
typescript// components/EducationNodeEditor.tsx

'use client';

import ReactFlow, {
  Node,
  Edge,
  Background,
  Controls,
  MiniMap,
  useNodesState,
  useEdgesState,
  addEdge,
  Connection,
} from 'reactflow';
import 'reactflow/dist/style.css';

export default function EducationNodeEditor() {
  const [nodes, setNodes, onNodesChange] = useNodesState([
    {
      id: 'start',
      type: 'START',
      position: { x: 250, y: 0 },
      data: { label: 'ì‹œì‘' },
    },
  ]);
  
  const [edges, setEdges, onEdgesChange] = useEdgesState([]);
  
  const onConnect = (params: Connection) => {
    setEdges((eds) => addEdge(params, eds));
  };
  
  const onDrop = (event: React.DragEvent) => {
    event.preventDefault();
    
    const videoData = JSON.parse(event.dataTransfer.getData('video'));
    const position = {
      x: event.clientX,
      y: event.clientY,
    };
    
    const newNode: Node = {
      id: `video-${Date.now()}`,
      type: 'VIDEO',
      position,
      data: {
        videoId: videoData.id,
        videoTitle: videoData.title,
        videoDuration: videoData.duration,
        videoThumbnail: videoData.thumbnailUrl,
      },
    };
    
    setNodes((nds) => nds.concat(newNode));
  };
  
  return (
    <div style={{ width: '100%', height: '600px' }}>
      <ReactFlow
        nodes={nodes}
        edges={edges}
        onNodesChange={onNodesChange}
        onEdgesChange={onEdgesChange}
        onConnect={onConnect}
        onDrop={onDrop}
        onDragOver={(e) => e.preventDefault()}
        fitView
      >
        <Background />
        <Controls />
        <MiniMap />
      </ReactFlow>
    </div>
  );
}
6.2. êµìœ¡ ê³¼ì • ì €ì¥
typescript// app/api/courses/route.ts

export async function POST(request: Request) {
  const session = await getServerSession();
  const { title, description, nodes, edges } = await request.json();
  
  // 1. ì´ ì‹œê°„ ê³„ì‚°
  const totalDuration = nodes
    .filter((node: EducationNode) => node.type === 'VIDEO')
    .reduce((sum: number, node: EducationNode) => {
      return sum + (node.data.videoDuration || 0);
    }, 0);
  
  // 2. ëŒ€í‘œ ì¸ë„¤ì¼ (ì²« ì˜ìƒ)
  const firstVideoNode = nodes.find((n: EducationNode) => n.type === 'VIDEO');
  const thumbnail = firstVideoNode?.data.videoThumbnail;
  
  // 3. DB ì €ì¥
  const course = await prisma.educationCourse.create({
    data: {
      title,
      description,
      thumbnail,
      nodes: JSON.stringify(nodes),
      edges: JSON.stringify(edges),
      totalDuration,
      ownerId: session.user.id,
    },
  });
  
  return NextResponse.json(course);
}
6.3. êµìœ¡ ê³¼ì • ê³µìœ 
typescript// app/api/courses/[id]/share/route.ts

export async function POST(
  request: Request,
  { params }: { params: { id: string } }
) {
  const { userIds } = await request.json(); // ê³µìœ  ëŒ€ìƒ ì‚¬ìš©ì ID ë°°ì—´
  
  await prisma.educationCourse.update({
    where: { id: params.id },
    data: {
      sharedWith: {
        push: userIds,
      },
    },
  });
  
  return NextResponse.json({ success: true });
}

7. ë‹¤êµ­ì–´ ë° ìë§‰ ì‹œìŠ¤í…œ
7.1. ìë§‰ íŒŒì¼ ê´€ë¦¬
7.1.1. ìë§‰ ì—…ë¡œë“œ (SRT/VTT)
typescript// app/api/videos/[id]/subtitles/route.ts

export async function POST(
  request: Request,
  { params }: { params: { id: string } }
) {
  const formData = await request.formData();
  const file = formData.get('file') as File;
  const language = formData.get('language') as string;
  const label = formData.get('label') as string; // "English", "Tiáº¿ng Viá»‡t"
  
  // 1. Cloudflare R2ì— ì—…ë¡œë“œ
  const fileName = `${params.id}/${language}.${file.name.endsWith('.vtt') ? 'vtt' : 'srt'}`;
  const uploadResponse = await uploadToR2(file, fileName);
  
  // 2. DB ì—…ë°ì´íŠ¸
  const video = await prisma.video.findUnique({
    where: { id: params.id },
  });
  
  const subtitles = video.subtitles as SubtitleTrack[] || [];
  
  subtitles.push({
    language,
    label,
    url: uploadResponse.url,
    format: file.name.endsWith('.vtt') ? 'vtt' : 'srt',
    source: 'MANUAL',
    createdAt: new Date().toISOString(),
  });
  
  await prisma.video.update({
    where: { id: params.id },
    data: { subtitles },
  });
  
  return NextResponse.json({ success: true });
}
7.2. AI ìë™ ë²ˆì—­ (OpenAI Whisper + GPT-4)
7.2.1. ìŒì„± â†’ í…ìŠ¤íŠ¸ (Whisper)
typescript// app/lib/ai/whisper-transcribe.ts

import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function transcribeVideo(videoUrl: string): Promise<string> {
  // 1. ì˜ìƒì—ì„œ ì˜¤ë””ì˜¤ ì¶”ì¶œ (FFmpeg)
  const audioBuffer = await extractAudio(videoUrl);
  
  // 2. Whisper API í˜¸ì¶œ
  const transcription = await openai.audio.transcriptions.create({
    file: audioBuffer,
    model: 'whisper-1',
    language: 'ko', // í•œêµ­ì–´ ìŒì„±
    response_format: 'srt', // SRT í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
  });
  
  return transcription.text;
}
7.2.2. ë²ˆì—­ (GPT-4)
typescript// app/lib/ai/translate-subtitles.ts

export async function translateSubtitles(
  srtContent: string,
  targetLanguage: string
): Promise<string> {
  const completion = await openai.chat.completions.create({
    model: 'gpt-4-turbo',
    messages: [
      {
        role: 'system',
        content: `You are a professional translator. Translate the following SRT subtitle file from Korean to ${targetLanguage}. Preserve the SRT format and timing codes exactly.`,
      },
      {
        role: 'user',
        content: srtContent,
      },
    ],
    temperature: 0.3,
  });
  
  return completion.choices[0].message.content;
}
7.2.3. ì „ì²´ í”„ë¡œì„¸ìŠ¤
typescript// app/api/videos/[id]/ai-translate/route.ts

export async function POST(
  request: Request,
  { params }: { params: { id: string } }
) {
  const { targetLanguages } = await request.json(); // ["en", "vi", "zh"]
  
  const video = await prisma.video.findUnique({
    where: { id: params.id },
  });
  
  // 1. Whisperë¡œ í•œêµ­ì–´ ìë§‰ ìƒì„±
  const koreanSRT = await transcribeVideo(video.videoUrl);
  
  // 2. ê° ì–¸ì–´ë¡œ ë²ˆì—­
  for (const lang of targetLanguages) {
    const translatedSRT = await translateSubtitles(koreanSRT, lang);
    
    // 3. R2ì— ì—…ë¡œë“œ
    const fileName = `${params.id}/${lang}.srt`;
    const uploadResponse = await uploadToR2(
      new Blob([translatedSRT]),
      fileName
    );
    
    // 4. DB ì—…ë°ì´íŠ¸
    const subtitles = video.subtitles as SubtitleTrack[] || [];
    subtitles.push({
      language: lang,
      label: LANGUAGE_LABELS[lang],
      url: uploadResponse.url,
      format: 'srt',
      source: 'AI',
      createdAt: new Date().toISOString(),
    });
    
    await prisma.video.update({
      where: { id: params.id },
      data: { subtitles },
    });
  }
  
  return NextResponse.json({ success: true });
}
7.3. ì˜ìƒ ì¬ìƒ ì‹œ ìë§‰ í‘œì‹œ
typescript// components/VideoPlayer.tsx

export default function VideoPlayer({ video, language }: VideoPlayerProps) {
  const subtitle = (video.subtitles as SubtitleTrack[])?.find(
    (s) => s.language === language
  );
  
  if (video.provider === 'VIMEO') {
    return (
      <iframe
        src={`https://player.vimeo.com/video/${video.providerId}?texttrack=${language}`}
        width="100%"
        height="100%"
        frameBorder="0"
        allow="autoplay; fullscreen"
        allowFullScreen
      />
    );
  }
  
  if (video.provider === 'CLOUDFLARE') {
    return (
      <video controls width="100%">
        <source src={video.videoUrl} />
        {subtitle && (
          <track
            kind="subtitles"
            src={subtitle.url}
            srcLang={subtitle.language}
            label={subtitle.label}
            default={language === 'ko'}
          />
        )}
      </video>
    );
  }
}

8. QR ê¸°ë°˜ ì¦ë¹™ ì‹œìŠ¤í…œ
8.1. êµìœ¡ ì‹¤í–‰ íë¦„
mermaidgraph TD
    A[êµìœ¡ ì‹œì‘] --> B{ì–¸ì–´ ì„ íƒ íŒì—…}
    B -->|í•œêµ­ì–´| C[PC í™”ë©´ ì¬ìƒ]
    B -->|ì™¸êµ­ì–´| D[QR ì½”ë“œ ìƒì„± + í‘œì‹œ]
    
    D --> E[ì™¸êµ­ì¸: ëª¨ë°”ì¼ë¡œ QR ìŠ¤ìº”]
    E --> F[ëª¨ë°”ì¼ì—ì„œ ì–¸ì–´ ì¬ì„ íƒ]
    F --> G[ëª¨ë°”ì¼ ì¬ìƒ + ìë§‰]
    
    C --> H[êµìœ¡ ì™„ë£Œ]
    G --> H
    
    H --> I[PCì— QR ì½”ë“œ í‘œì‹œ]
    I --> J[ëª¨ë“  ì°¸ì„ì: ëª¨ë°”ì¼ë¡œ QR ìŠ¤ìº”]
    J --> K[ì¦ë¹™ ìˆ˜ì§‘ í˜ì´ì§€]
    
    K --> L[ì´ë¦„ ì…ë ¥]
    L --> M[ì…€ì¹´ ì´¬ì˜]
    M --> N[ì „ì ì„œëª…]
    N --> O[ê°œì¸ì •ë³´ ë™ì˜ ì²´í¬]
    O --> P[ì™„ë£Œ ë²„íŠ¼]
    
    P --> Q[ì„œë²„: PDF ìƒì„±]
    Q --> R[ëŒ€ì‹œë³´ë“œ ì•Œë¦¼]
8.2. ì–¸ì–´ ì„ íƒ íŒì—…
typescript// components/LanguageSelectionModal.tsx

export default function LanguageSelectionModal({ onSelect }: Props) {
  const languages = [
    { code: 'ko', label: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·' },
    { code: 'en', label: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
    { code: 'vi', label: 'Tiáº¿ng Viá»‡t', flag: 'ğŸ‡»ğŸ‡³' },
    { code: 'zh', label: 'ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
    { code: 'th', label: 'à¹„à¸—à¸¢', flag: 'ğŸ‡¹ğŸ‡­' },
  ];
  
  return (
    <Modal isOpen>
      <h2>ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš” / Select Language</h2>
      <div className="grid grid-cols-2 gap-4">
        {languages.map((lang) => (
          <button
            key={lang.code}
            onClick={() => onSelect(lang.code)}
            className="p-4 border rounded-lg hover:bg-blue-50"
          >
            <span className="text-4xl">{lang.flag}</span>
            <p className="mt-2">{lang.label}</p>
          </button>
        ))}
      </div>
      <p className="mt-4 text-sm text-gray-600">
        â„¹ï¸ ì™¸êµ­ì–´ ì„ íƒ ì‹œ QR ì½”ë“œê°€ í‘œì‹œë©ë‹ˆë‹¤.
      </p>
    </Modal>
  );
}
8.3. QR í† í° ìƒì„±
typescript// app/lib/qr/generate-qr-token.ts

import jwt from 'jsonwebtoken';
import QRCode from 'qrcode';

interface QRTokenPayload {
  sessionId: string;
  courseId: string;
  tenantId: string;
  language: string;
  expiresAt: number;
}

export async function generateQRToken(payload: QRTokenPayload): Promise<string> {
  // 1. JWT í† í° ìƒì„±
  const token = jwt.sign(
    payload,
    process.env.JWT_SECRET!,
    { expiresIn: '30m' } // ê¸°ë³¸ 30ë¶„
  );
  
  // 2. QR ì½”ë“œ URL
  const qrUrl = `${process.env.NEXT_PUBLIC_APP_URL}/mobile/learn?token=${token}`;
  
  // 3. QR ì½”ë“œ ì´ë¯¸ì§€ ìƒì„± (Base64)
  const qrCodeDataUrl = await QRCode.toDataURL(qrUrl, {
    width: 400,
    margin: 2,
  });
  
  return qrCodeDataUrl;
}
8.4. ëª¨ë°”ì¼ í•™ìŠµ í˜ì´ì§€
typescript// app/mobile/learn/page.tsx

export default async function MobileLearnPage({
  searchParams,
}: {
  searchParams: { token: string };
}) {
  // 1. í† í° ê²€ì¦
  const payload = verifyQRToken(searchParams.token);
  
  if (!payload) {
    return <div>ìœ íš¨í•˜ì§€ ì•Šì€ QR ì½”ë“œì…ë‹ˆë‹¤.</div>;
  }
  
  // 2. êµìœ¡ ê³¼ì • ì •ë³´ ì¡°íšŒ
  const course = await prisma.educationCourse.findUnique({
    where: { id: payload.courseId },
  });
  
  return (
    <div className="mobile-learn-container">
      <h1>{course.title}</h1>
      
      {/* ì–¸ì–´ ì¬ì„ íƒ */}
      <LanguageSelector defaultLanguage={payload.language} />
      
      {/* ì˜ìƒ ì¬ìƒ */}
      <VideoPlayer course={course} language={payload.language} />
      
      {/* ì§„í–‰ë¥  */}
      <ProgressBar />
    </div>
  );
}
8.5. ì¦ë¹™ ìˆ˜ì§‘ í˜ì´ì§€
typescript// app/mobile/verify/page.tsx

export default function VerifyPage({ searchParams }: { searchParams: { token: string } }) {
  const [name, setName] = useState('');
  const [selfieUrl, setSelfieUrl] = useState('');
  const [signatureUrl, setSignatureUrl] = useState('');
  const [consentGiven, setConsentGiven] = useState(false);
  
  const handleSubmit = async () => {
    const response = await fetch('/api/education/verify', {
      method: 'POST',
      body: JSON.stringify({
        token: searchParams.token,
        name,
        selfieUrl,
        signatureUrl,
        consentGiven,
        gps: await getCurrentPosition(),
      }),
    });
    
    if (response.ok) {
      alert('ì¦ë¹™ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
  };
  
  return (
    <div className="max-w-md mx-auto p-6">
      <h1>ğŸ“¸ êµìœ¡ ì´ìˆ˜ í™•ì¸</h1>
      
      {/* ì´ë¦„ ì…ë ¥ */}
      <input
        type="text"
        value={name}
        onChange={(e) => setName(e.target.value)}
        placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
        className="w-full px-4 py-2 border rounded"
      />
      
      {/* ì…€ì¹´ ì´¬ì˜ */}
      <SelfieCapture onCapture={setSelfieUrl} />
      
      {/* ì „ì ì„œëª… */}
      <SignatureCanvas onSave={setSignatureUrl} />
      
      {/* ê°œì¸ì •ë³´ ë™ì˜ */}
      <label className="flex items-center mt-4">
        <input
          type="checkbox"
          checked={consentGiven}
          onChange={(e) => setConsentGiven(e.target.checked)}
        />
        <span className="ml-2">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ (í•„ìˆ˜)</span>
      </label>
      
      <button
        onClick={handleSubmit}
        disabled={!name || !selfieUrl || !signatureUrl || !consentGiven}
        className="w-full mt-6 py-3 bg-blue-600 text-white rounded disabled:opacity-50"
      >
        ì™„ë£Œ
      </button>
    </div>
  );
}
8.6. ì…€ì¹´ ì´¬ì˜ ì»´í¬ë„ŒíŠ¸
typescript// components/SelfieCapture.tsx

'use client';

import { useRef, useState } from 'react';

export default function SelfieCapture({ onCapture }: { onCapture: (url: string) => void }) {
  const videoRef = useRef<HTMLVideoElement>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [stream, setStream] = useState<MediaStream | null>(null);
  
  const startCamera = async () => {
    try {
      const mediaStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'user' }, // ì „ë©´ ì¹´ë©”ë¼
        audio: false,
      });
      
      if (videoRef.current) {
        videoRef.current.srcObject = mediaStream;
      }
      
      setStream(mediaStream);
    } catch (error) {
      alert('ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”');
    }
  };
  
  const capturePhoto = async () => {
    if (!videoRef.current || !canvasRef.current) return;
    
    const video = videoRef.current;
    const canvas = canvasRef.current;
    
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    
    const ctx = canvas.getContext('2d');
    ctx?.drawImage(video, 0, 0);
    
    // Canvas â†’ Blob
    canvas.toBlob(async (blob) => {
      if (!blob) return;
      
      // Cloudflare R2 ì—…ë¡œë“œ
      const formData = new FormData();
      formData.append('file', blob, 'selfie.jpg');
      
      const response = await fetch('/api/upload/selfie', {
        method: 'POST',
        body: formData,
      });
      
      const data = await response.json();
      onCapture(data.url);
      
      // ì¹´ë©”ë¼ ì¢…ë£Œ
      stream?.getTracks().forEach((track) => track.stop());
    }, 'image/jpeg', 0.9);
  };
  
  return (
    <div className="my-4">
      <h3 className="font-medium mb-2">ğŸ“· ì…€ì¹´ ì´¬ì˜</h3>
      
      <video ref={videoRef} autoPlay className="w-full rounded" />
      <canvas ref={canvasRef} style={{ display: 'none' }} />
      
      <div className="flex gap-2 mt-2">
        <button onClick={startCamera} className="px-4 py-2 bg-blue-600 text-white rounded">
          ì¹´ë©”ë¼ ì‹œì‘
        </button>
        <button onClick={capturePhoto} className="px-4 py-2 bg-green-600 text-white rounded">
          ì´¬ì˜í•˜ê¸°
        </button>
      </div>
    </div>
  );
}
8.7. ì „ì ì„œëª… ì»´í¬ë„ŒíŠ¸
typescript// components/SignatureCanvas.tsx

'use client';

import { useRef } from 'react';
import SignatureCanvas from 'react-signature-canvas';

export default function Signature({ onSave }: { onSave: (url: string) => void }) {
  const sigPadRef = useRef<SignatureCanvas>(null);
  
  const handleSave = async () => {
    if (!sigPadRef.current) return;
    
    const dataUrl = sigPadRef.current.toDataURL('image/png');
    
    // Base64 â†’ Blob
    const blob = await (await fetch(dataUrl)).blob();
    
    // Cloudflare R2 ì—…ë¡œë“œ
    const formData = new FormData();
    formData.append('file', blob, 'signature.png');
    
    const response = await fetch('/api/upload/signature', {
      method: 'POST',
      body: formData,
    });
    
    const data = await response.json();
    onSave(data.url);
  };
  
  const handleClear = () => {
    sigPadRef.current?.clear();
  };
  
  return (
    <div className="my-4">
      <h3 className="font-medium mb-2">âœï¸ ì „ì ì„œëª…</h3>
      
      <div className="border border-gray-300 rounded">
        <SignatureCanvas
          ref={sigPadRef}
          canvasProps={{
            width: 400,
            height: 200,
            className: 'signature-canvas',
          }}
        />
      </div>
      
      <div className="flex gap-2 mt-2">
        <button onClick={handleClear} className="px-4 py-2 bg-gray-300 rounded">
          ì§€ìš°ê¸°
        </button>
        <button onClick={handleSave} className="px-4 py-2 bg-blue-600 text-white rounded">
          ì €ì¥
        </button>
      </div>
    </div>
  );
}

9. PDF ìë™ ìƒì„±
9.1. PDF í…œí”Œë¦¿ (@react-pdf/renderer)
typescript// app/lib/pdf/certificate-template.tsx

import { Document, Page, Text, View, Image, StyleSheet } from '@react-pdf/renderer';
import { Font } from '@react-pdf/renderer';

// í•œê¸€ í°íŠ¸ ë“±ë¡
Font.register({
  family: 'Noto Sans KR',
  src: '/fonts/NotoSansKR-Regular.ttf',
});

const styles = StyleSheet.create({
  page: {
    fontFamily: 'Noto Sans KR',
    padding: 40,
  },
  header: {
    fontSize: 24,
    textAlign: 'center',
    marginBottom: 20,
  },
  section: {
    margin: 10,
    padding: 10,
  },
  table: {
    display: 'table' as any,
    width: 'auto',
    borderStyle: 'solid',
    borderWidth: 1,
    borderColor: '#000',
  },
  tableRow: {
    flexDirection: 'row',
  },
  tableCell: {
    width: '25%',
    borderStyle: 'solid',
    borderWidth: 1,
    padding: 5,
  },
});

interface CertificateProps {
  companyName: string;
  siteName?: string;
  educationTitle: string;
  educationDate: string;
  totalDuration: number;
  attendees: Attendee[];
  screenshots: string[];
}

export default function CertificateTemplate(props: CertificateProps) {
  return (
    <Document>
      <Page size="A4" style={styles.page}>
        {/* í—¤ë” */}
        <Text style={styles.header}>ì•ˆì „êµìœ¡ ì´ìˆ˜ í™•ì¸ì„œ</Text>
        
        {/* ê¸°ë³¸ ì •ë³´ */}
        <View style={styles.section}>
          <Text>íšŒì‚¬ëª…: {props.companyName}</Text>
          {props.siteName && <Text>í˜„ì¥ëª…: {props.siteName}</Text>}
          <Text>êµìœ¡ëª…: {props.educationTitle}</Text>
          <Text>êµìœ¡ì¼ì‹œ: {props.educationDate}</Text>
          <Text>ì´ ì‹œê°„: {Math.floor(props.totalDuration / 60)}ë¶„ {props.totalDuration % 60}ì´ˆ</Text>
        </View>
        
        {/* êµìœ¡ ìŠ¤í¬ë¦°ìƒ· */}
        <View style={styles.section}>
          <Text>êµìœ¡ ë‚´ìš©:</Text>
          {props.screenshots.map((url, idx) => (
            <Image key={idx} src={url} style={{ width: 200, height: 112, margin: 5 }} />
          ))}
        </View>
        
        {/* ì°¸ì„ì ì„œëª… ë¦¬ìŠ¤íŠ¸ */}
        <View style={styles.section}>
          <Text>ì°¸ì„ì ì„œëª… ë¦¬ìŠ¤íŠ¸:</Text>
          
          <View style={styles.table}>
            {/* í…Œì´ë¸” í—¤ë” */}
            <View style={styles.tableRow}>
              <Text style={styles.tableCell}>ë²ˆí˜¸</Text>
              <Text style={styles.tableCell}>ì´ë¦„</Text>
              <Text style={styles.tableCell}>êµ­ì </Text>
              <Text style={styles.tableCell}>ì„œëª…/ì…€ì¹´</Text>
            </View>
            
            {/* ì°¸ì„ì í–‰ */}
            {props.attendees.map((attendee, idx) => (
              <View key={idx} style={styles.tableRow}>
                <Text style={styles.tableCell}>{idx + 1}</Text>
                <Text style={styles.tableCell}>{attendee.name}</Text>
                <Text style={styles.tableCell}>{NATIONALITY_FLAGS[attendee.nationality]}</Text>
                <View style={styles.tableCell}>
                  <Image src={attendee.signatureUrl} style={{ width: 40, height: 20 }} />
                  <Image src={attendee.selfieUrl} style={{ width: 30, height: 40 }} />
                </View>
              </View>
            ))}
          </View>
        </View>
        
        {/* QR ì½”ë“œ */}
        <View style={{ textAlign: 'center', marginTop: 20 }}>
          <Text>ë¬¸ì„œ ê²€ì¦ìš© QR ì½”ë“œ</Text>
          <Image src={props.qrCode} style={{ width: 100, height: 100, margin: 'auto' }} />
        </View>
      </Page>
    </Document>
  );
}
9.2. PDF ìƒì„± API
typescript// app/api/pdf/generate/route.ts

import { renderToStream } from '@react-pdf/renderer';
import CertificateTemplate from '@/lib/pdf/certificate-template';

export async function POST(request: Request) {
  const {
    historyId,
    companyName,
    siteName,
    educationTitle,
    educationDate,
    totalDuration,
    attendees,
    screenshots,
  } = await request.json();
  
  // 1. QR ì½”ë“œ ìƒì„± (ë¬¸ì„œ ê²€ì¦ìš©)
  const verifyUrl = `${process.env.NEXT_PUBLIC_APP_URL}/verify/${historyId}`;
  const qrCodeDataUrl = await QRCode.toDataURL(verifyUrl);
  
  // 2. PDF ë Œë”ë§
  const stream = await renderToStream(
    <CertificateTemplate
      companyName={companyName}
      siteName={siteName}
      educationTitle={educationTitle}
      educationDate={educationDate}
      totalDuration={totalDuration}
      attendees={attendees}
      screenshots={screenshots}
      qrCode={qrCodeDataUrl}
    />
  );
  
  // 3. Cloudflare R2ì— ì—…ë¡œë“œ
  const fileName = `certificates/${historyId}.pdf`;
  const pdfBuffer = await streamToBuffer(stream);
  const uploadResponse = await uploadToR2(pdfBuffer, fileName);
  
  // 4. DB ì—…ë°ì´íŠ¸
  await prisma.educationHistory.update({
    where: { id: historyId },
    data: {
      certificateUrl: uploadResponse.url,
    },
  });
  
  return NextResponse.json({ url: uploadResponse.url });
}

10. êµìœ¡ ì´ë ¥ ê´€ë¦¬
10.1. êµìœ¡ ì´ë ¥ ì¡°íšŒ API
typescript// app/api/histories/route.ts

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const startDate = searchParams.get('startDate');
  const endDate = searchParams.get('endDate');
  const courseId = searchParams.get('courseId');
  const attendeeName = searchParams.get('attendeeName');
  const nationality = searchParams.get('nationality');
  
  const histories = await prisma.educationHistory.findMany({
    where: {
      AND: [
        startDate ? { completedAt: { gte: new Date(startDate) } } : {},
        endDate ? { completedAt: { lte: new Date(endDate) } } : {},
        courseId ? { courseId } : {},
        // JSON í•„ë“œ ê²€ìƒ‰ (PostgreSQL)
        attendeeName ? {
          attendees: {
            path: '$[*].name',
            array_contains: attendeeName,
          },
        } : {},
      ],
    },
    include: {
      course: true,
      executor: true,
    },
    orderBy: {
      completedAt: 'desc',
    },
  });
  
  return NextResponse.json(histories);
}
10.2. ì›”ë³„ í†µê³„ API
typescript// app/api/statistics/monthly/route.ts

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const year = parseInt(searchParams.get('year') || String(new Date().getFullYear()));
  const month = parseInt(searchParams.get('month') || String(new Date().getMonth() + 1));
  
  const startDate = new Date(year, month - 1, 1);
  const endDate = new Date(year, month, 0, 23, 59, 59);
  
  const histories = await prisma.educationHistory.findMany({
    where: {
      completedAt: {
        gte: startDate,
        lte: endDate,
      },
    },
    include: {
      course: true,
    },
  });
  
  // í†µê³„ ê³„ì‚°
  const stats = {
    totalSessions: histories.length,
    totalAttendees: histories.reduce((sum, h) => sum + h.totalAttendees, 0),
    byNationality: {},
    popularCourses: {},
  };
  
  histories.forEach((history) => {
    // êµ­ì ë³„ ì§‘ê³„
    const byNat = history.byNationality as any;
    Object.entries(byNat || {}).forEach(([nat, count]) => {
      stats.byNationality[nat] = (stats.byNationality[nat] || 0) + count;
    });
    
    // ì¸ê¸° êµìœ¡ ì§‘ê³„
    const courseTitle = history.courseTitleSnapshot;
    stats.popularCourses[courseTitle] = (stats.popularCourses[courseTitle] || 0) + 1;
  });
  
  return NextResponse.json(stats);
}
10.3. Excel ë³´ê³ ì„œ ìƒì„±
typescript// app/api/reports/excel/route.ts

import * as XLSX from 'xlsx';

export async function POST(request: Request) {
  const { historyIds } = await request.json();
  
  const histories = await prisma.educationHistory.findMany({
    where: { id: { in: historyIds } },
    include: { course: true },
  });
  
  // Excel ë°ì´í„° ì¤€ë¹„
  const rows = [];
  
  histories.forEach((history) => {
    const attendees = history.attendees as Attendee[];
    
    attendees.forEach((attendee, idx) => {
      rows.push({
        'êµìœ¡ì¼ì‹œ': new Date(history.completedAt!).toLocaleString('ko-KR'),
        'êµìœ¡ëª…': history.courseTitleSnapshot,
        'ë²ˆí˜¸': idx + 1,
        'ì´ë¦„': attendee.name,
        'êµ­ì ': attendee.nationality,
        'ì–¸ì–´': attendee.language,
        'ì™„ë£Œ ì‹œê°„': new Date(attendee.completedAt).toLocaleString('ko-KR'),
        'ê¸°ê¸°': attendee.deviceType,
      });
    });
  });
  
  // Excel ì›Œí¬ë¶ ìƒì„±
  const worksheet = XLSX.utils.json_to_sheet(rows);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'êµìœ¡ ì´ë ¥');
  
  // Bufferë¡œ ë³€í™˜
  const excelBuffer = XLSX.write(workbook, { type: 'buffer', bookType: 'xlsx' });
  
  // Cloudflare R2 ì—…ë¡œë“œ
  const fileName = `reports/education-${Date.now()}.xlsx`;
  const uploadResponse = await uploadToR2(excelBuffer, fileName);
  
  return NextResponse.json({ url: uploadResponse.url });
}

11. ë³´ì•ˆ ë° ì ‘ê·¼ ì œì–´
11.1. Middleware (IP ê²€ì¦ + í…Œë„ŒíŠ¸ ì‹ë³„)
typescript// middleware.ts

import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';
import { getToken } from 'next-auth/jwt';

export async function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname;
  
  // Public ê²½ë¡œëŠ” ê²€ì¦ ìŠ¤í‚µ
  if (pathname.startsWith('/auth') || pathname.startsWith('/api/auth')) {
    return NextResponse.next();
  }
  
  // 1. JWT í† í° ê²€ì¦
  const token = await getToken({
    req: request,
    secret: process.env.NEXTAUTH_SECRET,
  });
  
  if (!token) {
    return NextResponse.redirect(new URL('/auth/signin', request.url));
  }
  
  // 2. í…Œë„ŒíŠ¸ ì •ë³´ ì¡°íšŒ (ìºì‹±)
  const tenant = await getTenantById(token.tenantId);
  
  if (!tenant) {
    return NextResponse.json({ error: 'Invalid tenant' }, { status: 403 });
  }
  
  // 3. IP ê²€ì¦
  const clientIp = request.ip || request.headers.get('x-forwarded-for');
  
  if (!isIpAllowed(clientIp, tenant.ipRanges)) {
    return NextResponse.json(
      { error: 'í—ˆìš©ë˜ì§€ ì•Šì€ IP ì£¼ì†Œì…ë‹ˆë‹¤' },
      { status: 403 }
    );
  }
  
  // 4. ìš”ì²­ í—¤ë”ì— í…Œë„ŒíŠ¸ ì •ë³´ ì¶”ê°€
  const requestHeaders = new Headers(request.headers);
  requestHeaders.set('x-tenant-id', tenant.id);
  requestHeaders.set('x-tenant-schema', tenant.schemaName);
  
  return NextResponse.next({
    request: {
      headers: requestHeaders,
    },
  });
}

export const config = {
  matcher: [
    '/dashboard/:path*',
    '/api/:path*',
  ],
};
11.2. RBAC (Role-Based Access Control)
typescript// app/lib/auth/check-permission.ts

export function checkPermission(userRole: UserRole, action: string): boolean {
  const permissions = {
    ADMIN: [
      'video:create',
      'video:update',
      'video:delete',
      'course:create',
      'course:update',
      'course:delete',
      'course:share',
      'education:execute',
      'history:view',
      'user:manage',
      'settings:manage',
    ],
    SUB_ADMIN: [
      'video:view',
      'course:view',
      'education:execute',
      'history:view',
    ],
    USER: [
      'video:view',
      'course:view',
      'education:attend',
    ],
  };
  
  return permissions[userRole]?.includes(action) || false;
}
11.3. ì•”í˜¸í™” ë° ë³´ì•ˆ
typescript// app/lib/security/encryption.ts

import bcrypt from 'bcryptjs';
import crypto from 'crypto';

// ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
export async function hashPassword(password: string): Promise<string> {
  return bcrypt.hash(password, 12);
}

// ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
export async function verifyPassword(password: string, hash: string): Promise<boolean> {
  return bcrypt.compare(password, hash);
}

// ë¯¼ê° ë°ì´í„° ì•”í˜¸í™” (AES-256)
export function encrypt(text: string): string {
  const algorithm = 'aes-256-cbc';
  const key = Buffer.from(process.env.ENCRYPTION_KEY!, 'hex');
  const iv = crypto.randomBytes(16);
  
  const cipher = crypto.createCipheriv(algorithm, key, iv);
  let encrypted = cipher.update(text, 'utf8', 'hex');
  encrypted += cipher.final('hex');
  
  return `${iv.toString('hex')}:${encrypted}`;
}

// ë³µí˜¸í™”
export function decrypt(encryptedText: string): string {
  const [ivHex, encrypted] = encryptedText.split(':');
  const algorithm = 'aes-256-cbc';
  const key = Buffer.from(process.env.ENCRYPTION_KEY!, 'hex');
  const iv = Buffer.from(ivHex, 'hex');
  
  const decipher = crypto.createDecipheriv(algorithm, key, iv);
  let decrypted = decipher.update(encrypted, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  
  return decrypted;
}

12. API ëª…ì„¸
12.1. ì¸ì¦ API
MethodEndpointDescriptionPOST/api/auth/signupíšŒì›ê°€ì… (ì¶”ê°€ ì •ë³´ ì…ë ¥)POST/api/auth/signinë¡œê·¸ì¸ (NextAuth.js)GET/api/auth/sessioní˜„ì¬ ì„¸ì…˜ ì¡°íšŒPOST/api/auth/signoutë¡œê·¸ì•„ì›ƒ
12.2. ì˜ìƒ API
MethodEndpointDescriptionPOST/api/videosì˜ìƒ ë“±ë¡ (Vimeo URL or Cloudflare ì—…ë¡œë“œ)GET/api/videosì˜ìƒ ëª©ë¡ ì¡°íšŒ (í•„í„°ë§, í˜ì´ì§•)GET/api/videos/[id]ì˜ìƒ ìƒì„¸ ì¡°íšŒPUT/api/videos/[id]ì˜ìƒ ì •ë³´ ìˆ˜ì •DELETE/api/videos/[id]ì˜ìƒ ì‚­ì œPOST/api/videos/[id]/subtitlesìë§‰ ì—…ë¡œë“œPOST/api/videos/[id]/ai-translateAI ìë™ ë²ˆì—­POST/api/videos/previewë©”íƒ€ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (URL ì…ë ¥ ì‹œ)
12.3. êµìœ¡ ê³¼ì • API
MethodEndpointDescriptionPOST/api/coursesêµìœ¡ ê³¼ì • ìƒì„± (ë…¸ë“œ ì €ì¥)GET/api/coursesêµìœ¡ ê³¼ì • ëª©ë¡ ì¡°íšŒGET/api/courses/[id]êµìœ¡ ê³¼ì • ìƒì„¸ ì¡°íšŒPUT/api/courses/[id]êµìœ¡ ê³¼ì • ìˆ˜ì •DELETE/api/courses/[id]êµìœ¡ ê³¼ì • ì‚­ì œPOST/api/courses/[id]/shareêµìœ¡ ê³¼ì • ê³µìœ POST/api/courses/[id]/duplicateêµìœ¡ ê³¼ì • ë³µì‚¬
12.4. êµìœ¡ ì‹¤í–‰ API
MethodEndpointDescriptionPOST/api/education/startêµìœ¡ ì‹œì‘ (ì„¸ì…˜ ìƒì„±)POST/api/education/qr-tokenQR í† í° ìƒì„±GET/api/education/qr-verifyQR í† í° ê²€ì¦POST/api/education/verifyì¦ë¹™ ì œì¶œ (ì´ë¦„, ì…€ì¹´, ì„œëª…)POST/api/education/completeêµìœ¡ ì™„ë£Œ
12.5. êµìœ¡ ì´ë ¥ API
MethodEndpointDescriptionGET/api/historiesêµìœ¡ ì´ë ¥ ëª©ë¡ ì¡°íšŒ (í•„í„°ë§)GET/api/histories/[id]êµìœ¡ ì´ë ¥ ìƒì„¸ ì¡°íšŒGET/api/statistics/monthlyì›”ë³„ í†µê³„POST/api/reports/excelExcel ë³´ê³ ì„œ ìƒì„±
12.6. PDF API
MethodEndpointDescriptionPOST/api/pdf/generatePDF ìƒì„±GET/api/pdf/[id]PDF ë‹¤ìš´ë¡œë“œ
12.7. ì‚¬ìš©ì ê´€ë¦¬ API (íšŒì‚¬ ê³„ì •)
MethodEndpointDescriptionPOST/api/usersíšŒì› ì¶”ê°€GET/api/usersíšŒì› ëª©ë¡ ì¡°íšŒPUT/api/users/[id]íšŒì› ì •ë³´ ìˆ˜ì •DELETE/api/users/[id]íšŒì› ì‚­ì œPOST/api/users/bulk-importExcel ì¼ê´„ ë“±ë¡

12.8. ê²°ì œ API

#### ì‚¬ìš©ììš© ê²°ì œ API
MethodEndpointDescriptionGET/api/payments/subscriptionì‚¬ìš©ì êµ¬ë… ì •ë³´ ì¡°íšŒPUT/api/payments/subscriptionêµ¬ë… í”Œëœ ë³€ê²½DELETE/api/payments/subscriptionêµ¬ë… ì·¨ì†ŒGET/api/payments/historyì‚¬ìš©ì ê²°ì œ ë‚´ì—­ ì¡°íšŒGET/api/payments/methodsì‚¬ìš©ì ê²°ì œ ìˆ˜ë‹¨ ì¡°íšŒPOST/api/payments/methodsìƒˆ ê²°ì œ ìˆ˜ë‹¨ ì¶”ê°€PUT/api/payments/methods/[id]ê²°ì œ ìˆ˜ë‹¨ ìˆ˜ì •DELETE/api/payments/methods/[id]ê²°ì œ ìˆ˜ë‹¨ ì‚­ì œ

#### ê´€ë¦¬ììš© ê²°ì œ API
MethodEndpointDescriptionGET/api/admin/payments/historyì „ì²´ ì‚¬ìš©ì ê²°ì œ ë‚´ì—­ ì¡°íšŒGET/api/admin/payments/plansêµ¬ë… í”Œëœ ëª©ë¡ ì¡°íšŒPUT/api/admin/payments/plansêµ¬ë… í”Œëœ ì„¤ì • ì—…ë°ì´íŠ¸POST/api/admin/payments/plansìƒˆ êµ¬ë… í”Œëœ ìƒì„±POST/api/admin/payments/refundí™˜ë¶ˆ ì²˜ë¦¬POST/api/admin/payments/cancel-transactionì¹´ë“œ ê±°ë˜ ì·¨ì†ŒGET/api/admin/payments/trialsë¬´ë£Œ ì²´í—˜ ëª©ë¡ ì¡°íšŒPOST/api/admin/payments/trialsë¬´ë£Œ ì²´í—˜ ë¶€ì—¬PUT/api/admin/payments/trials/[id]/extendë¬´ë£Œ ì²´í—˜ ì—°ì¥

---

## 12.9. ê²°ì œ ì‹œìŠ¤í…œ ìƒì„¸ ëª…ì„¸

### 12.9.1. êµ¬ë… í”Œëœ êµ¬ì¡°

```typescript
interface SubscriptionPlan {
  id: string;
  type: "INDIVIDUAL" | "COMPANY";
  name: string;
  monthlyPrice: number;  // ì›”ê°„ ê°€ê²© (ì›)
  yearlyPrice: number;   // ì—°ê°„ ê°€ê²© (ì›)
  features: string[];    // í¬í•¨ëœ ê¸°ëŠ¥ ëª©ë¡
  maxUsers: number | null; // ìµœëŒ€ ì‚¬ìš©ì ìˆ˜ (null = ë¬´ì œí•œ)
  isActive: boolean;     // í”Œëœ í™œì„±í™” ì—¬ë¶€
  trialDays: number;     // ë¬´ë£Œ ì²´í—˜ ê¸°ê°„ (ì¼)
}
```

#### ê¸°ë³¸ í”Œëœ ì„¤ì •

**ê°œì¸ ê³„ì • (INDIVIDUAL)**
- ì›”ê°„: â‚©9,900/ì›”
- ì—°ê°„: â‚©99,000/ë…„ (2ê°œì›” ë¬´ë£Œ)
- ìµœëŒ€ ì‚¬ìš©ì: 1ëª…
- í¬í•¨ ê¸°ëŠ¥:
  - 1ì¸ ì‚¬ìš©
  - ê¸°ë³¸ êµìœ¡ ê¸°ëŠ¥
  - QR ì¦ë¹™ ì‹œìŠ¤í…œ
  - PDF ìƒì„±
  - êµìœ¡ ì´ë ¥ ì¡°íšŒ

**íšŒì‚¬ ê³„ì • (COMPANY)**
- ì›”ê°„: â‚©99,000/ì›”
- ì—°ê°„: â‚©990,000/ë…„ (2ê°œì›” ë¬´ë£Œ)
- ìµœëŒ€ ì‚¬ìš©ì: ë¬´ì œí•œ
- í¬í•¨ ê¸°ëŠ¥:
  - ë¬´ì œí•œ íšŒì› ë“±ë¡
  - ì˜ìƒ ì¡°í•© êµìœ¡ ë¬´ì œí•œ
  - QR ì¦ë¹™ ì‹œìŠ¤í…œ
  - ë‹¤êµ­ì–´ ì§€ì› (19ê°œ ì–¸ì–´)
  - AI ìë™ ë²ˆì—­
  - PDF ìë™ ìƒì„±
  - êµìœ¡ ì´ë ¥ ê´€ë¦¬
  - í†µê³„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
  - ìš°ì„  ê³ ê° ì§€ì›
  - ë§ì¶¤ ë¸Œëœë”©

### 12.9.2. ë¬´ë£Œ ì²´í—˜ ì‹œìŠ¤í…œ

```typescript
interface FreeTrial {
  id: string;
  userId: string;
  planType: "INDIVIDUAL" | "COMPANY";
  startDate: Date;
  endDate: Date;
  status: "active" | "expired" | "converted";
  convertedAt?: Date;
  convertedToPlanId?: string;
}
```

#### ë¬´ë£Œ ì²´í—˜ ì •ì±…
- ê¸°ë³¸ ì²´í—˜ ê¸°ê°„: 14ì¼
- ì‹ ê·œ ê°€ì… ì‹œ ìë™ ë¶€ì—¬
- ì²´í—˜ ê¸°ê°„ ì¤‘ ëª¨ë“  ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥
- ê´€ë¦¬ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì²´í—˜ ê¸°ê°„ ì—°ì¥ ê°€ëŠ¥
- ì²´í—˜ ì¢…ë£Œ ì „ 7ì¼, 3ì¼, 1ì¼ì— ì´ë©”ì¼ ì•Œë¦¼
- ì²´í—˜ ì¢…ë£Œ í›„ ìë™ìœ¼ë¡œ ìœ ë£Œ í”Œëœìœ¼ë¡œ ì „í™˜ (ì¹´ë“œ ë“±ë¡ ì‹œ)

### 12.9.3. ê²°ì œ ìˆ˜ë‹¨ ê´€ë¦¬

```typescript
interface PaymentMethod {
  id: string;
  userId: string;
  type: "card" | "bank";

  // ì¹´ë“œ ì •ë³´
  cardBrand?: "VISA" | "MASTERCARD" | "AMEX" | "JCB";
  cardLast4?: string;
  expiryDate?: string;

  // ê³„ì¢Œ ì •ë³´
  bankName?: string;
  accountLast4?: string;

  isDefault: boolean;
  pgCustomerKey: string; // PGì‚¬ ê³ ê° í‚¤
  pgPaymentKey: string;  // PGì‚¬ ê²°ì œ ìˆ˜ë‹¨ í‚¤

  createdAt: Date;
  updatedAt: Date;
}
```

#### PGì‚¬ ì—°ë™
- **ê¶Œì¥ PGì‚¬**: PortOne (êµ¬ ì•„ì„í¬íŠ¸) ë˜ëŠ” Toss Payments
- ì¹´ë“œ ì •ë³´ëŠ” PGì‚¬ì— ì €ì¥ (PCI-DSS ì¤€ìˆ˜)
- í”Œë«í¼ì—ëŠ” í† í°ê³¼ ë§ˆìŠ¤í‚¹ëœ ì •ë³´ë§Œ ì €ì¥
- ì •ê¸° ê²°ì œ (ë¹Œë§í‚¤) ì‚¬ìš©

### 12.9.4. ê²°ì œ ë‚´ì—­

```typescript
interface Payment {
  id: string;
  userId: string;
  planType: "INDIVIDUAL" | "COMPANY";
  interval: "monthly" | "yearly";
  amount: number;

  // ê²°ì œ ì •ë³´
  method: string;
  cardLast4?: string;
  pgTransactionId: string;

  // ìƒíƒœ
  status: "pending" | "completed" | "failed" | "refunded";

  // ë‚ ì§œ
  date: Date;
  refundedAt?: Date;
  refundReason?: string;

  // ì˜ìˆ˜ì¦
  receiptUrl?: string;

  createdAt: Date;
}
```

#### ê²°ì œ íë¦„

1. **ì •ê¸° ê²°ì œ ì„¤ì •**
   ```
   ì‚¬ìš©ì â†’ í”Œëœ ì„ íƒ â†’ ê²°ì œ ìˆ˜ë‹¨ ë“±ë¡ â†’ ë¹Œë§í‚¤ ë°œê¸‰ â†’ ì²« ê²°ì œ
   ```

2. **ìë™ ê°±ì‹ **
   ```
   ê²°ì œì¼ ë„ë˜ â†’ ë¹Œë§í‚¤ë¡œ ê²°ì œ ì‹œë„ â†’ ì„±ê³µ/ì‹¤íŒ¨ ì²˜ë¦¬ â†’ ì´ë©”ì¼ ì•Œë¦¼
   ```

3. **ê²°ì œ ì‹¤íŒ¨ ì²˜ë¦¬**
   ```
   ê²°ì œ ì‹¤íŒ¨ â†’ 3ì¼ í›„ ì¬ì‹œë„ â†’ ì‹¤íŒ¨ ì‹œ 7ì¼ í›„ ì¬ì‹œë„ â†’ ì‹¤íŒ¨ ì‹œ êµ¬ë… ì¼ì‹œì •ì§€
   ```

### 12.9.5. í™˜ë¶ˆ ì •ì±…

```typescript
interface Refund {
  id: string;
  paymentId: string;
  amount: number;
  reason: string;
  status: "pending" | "completed" | "rejected";
  processedBy: string; // ê´€ë¦¬ì ID
  processedAt?: Date;
  pgRefundId?: string;
  createdAt: Date;
}
```

#### í™˜ë¶ˆ ê·œì •
- **7ì¼ ì´ë‚´**: 100% í™˜ë¶ˆ
- **7ì¼ ì´í›„ ~ 1ê°œì›” ì´ë‚´**: ì‚¬ìš© ì¼ìˆ˜ ì œì™¸ í›„ í™˜ë¶ˆ
- **1ê°œì›” ì´í›„**: í™˜ë¶ˆ ë¶ˆê°€ (ë‹¨, ì„œë¹„ìŠ¤ ì¥ì•  ì‹œ ì˜ˆì™¸)
- ê´€ë¦¬ì ìŠ¹ì¸ í•„ìš”
- í™˜ë¶ˆ ì²˜ë¦¬ í›„ 3-5ì˜ì—…ì¼ ë‚´ ê³„ì¢Œ ì…ê¸ˆ

### 12.9.6. ì¹´ë“œ ê±°ë˜ ì·¨ì†Œ

```typescript
interface CardTransaction {
  id: string;
  userId: string;
  paymentId: string;
  cardLast4: string;
  cardBrand: string;
  amount: number;
  status: "completed" | "cancelled";
  canCancel: boolean; // 24ì‹œê°„ ì´ë‚´ë§Œ true
  cancelledAt?: Date;
  cancelledBy?: string; // ê´€ë¦¬ì ID
  pgTransactionId: string;
  date: Date;
}
```

#### ê±°ë˜ ì·¨ì†Œ ê·œì •
- **24ì‹œê°„ ì´ë‚´**: ê´€ë¦¬ìê°€ ì¦‰ì‹œ ì·¨ì†Œ ê°€ëŠ¥
- **24ì‹œê°„ ê²½ê³¼**: í™˜ë¶ˆ ì ˆì°¨ ì§„í–‰
- PGì‚¬ APIë¥¼ í†µí•œ ì‹¤ì‹œê°„ ì·¨ì†Œ ì²˜ë¦¬

### 12.9.7. ê´€ë¦¬ì ê¸°ëŠ¥

#### êµ¬ë… í†µê³„ ëŒ€ì‹œë³´ë“œ
```typescript
interface SubscriptionStats {
  totalSubscribers: number;        // ì´ êµ¬ë…ì ìˆ˜
  activeTrials: number;             // í™œì„± ë¬´ë£Œì²´í—˜ ìˆ˜
  monthlyRevenue: number;           // ì´ë²ˆ ë‹¬ ìˆ˜ìµ
  monthlyRefunds: number;           // ì´ë²ˆ ë‹¬ í™˜ë¶ˆì•¡
  conversionRate: number;           // ì²´í—˜â†’ìœ ë£Œ ì „í™˜ìœ¨
  churnRate: number;                // ì´íƒˆë¥ 

  // í”Œëœë³„ ë¶„í¬
  planDistribution: {
    individual: number;
    company: number;
  };

  // ì›”ë³„ ì¶”ì´
  monthlyTrend: {
    month: string;
    revenue: number;
    newSubscribers: number;
    churn: number;
  }[];
}
```

#### ê´€ë¦¬ì ê¶Œí•œ
- **êµ¬ë… ì„¤ì •**
  - í”Œëœ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
  - ê°€ê²© ë³€ê²½
  - ê¸°ëŠ¥ ì¶”ê°€/ì œê±°
  - í”Œëœ í™œì„±í™”/ë¹„í™œì„±í™”

- **ë¬´ë£Œ ì²´í—˜ ê´€ë¦¬**
  - ì²´í—˜ ê¸°ê°„ ë¶€ì—¬
  - ì²´í—˜ ê¸°ê°„ ì—°ì¥
  - ê°•ì œ ì „í™˜ (ì²´í—˜ â†’ ìœ ë£Œ)

- **ê²°ì œ ê´€ë¦¬**
  - ì „ì²´ ê²°ì œ ë‚´ì—­ ì¡°íšŒ
  - í™˜ë¶ˆ ì²˜ë¦¬
  - ì¹´ë“œ ê±°ë˜ ì·¨ì†Œ
  - ê²°ì œ ì‹¤íŒ¨ ì‚¬ìš©ì ê´€ë¦¬

### 12.9.8. ì´ë©”ì¼ ì•Œë¦¼

#### ì•Œë¦¼ ì¢…ë¥˜
- **êµ¬ë… ì‹œì‘**: ê²°ì œ ì™„ë£Œ ë° ì´ìš© ì•ˆë‚´
- **ê²°ì œ ì„±ê³µ**: ì›”ê°„/ì—°ê°„ ì •ê¸°ê²°ì œ ì„±ê³µ
- **ê²°ì œ ì‹¤íŒ¨**: ê²°ì œ ì‹¤íŒ¨ ë° ì¬ì‹œë„ ì•ˆë‚´
- **ì²´í—˜ ì¢…ë£Œ ì˜ˆì •**: 7ì¼ì „, 3ì¼ì „, 1ì¼ì „
- **ì²´í—˜ ì¢…ë£Œ**: ì²´í—˜ ì¢…ë£Œ ë° í”Œëœ ì„ íƒ ì•ˆë‚´
- **êµ¬ë… ê°±ì‹  ì˜ˆì •**: 7ì¼ì „
- **êµ¬ë… ì·¨ì†Œ**: ì·¨ì†Œ í™•ì¸ ë° í™˜ë¶ˆ ì•ˆë‚´
- **í™˜ë¶ˆ ì™„ë£Œ**: í™˜ë¶ˆ ì²˜ë¦¬ ì™„ë£Œ

### 12.9.9. Prisma Schema ì¶”ê°€

```prisma
// êµ¬ë… í”Œëœ
model SubscriptionPlan {
  id            String   @id @default(uuid())
  type          PlanType
  name          String
  monthlyPrice  Int
  yearlyPrice   Int
  features      String[]
  maxUsers      Int?
  isActive      Boolean  @default(true)
  trialDays     Int      @default(14)

  subscriptions Subscription[]

  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("subscription_plans")
}

enum PlanType {
  INDIVIDUAL
  COMPANY
}

// ì‚¬ìš©ì êµ¬ë…
model Subscription {
  id              String   @id @default(uuid())
  userId          String   @unique @map("user_id")
  user            User     @relation(fields: [userId], references: [id])

  planId          String   @map("plan_id")
  plan            SubscriptionPlan @relation(fields: [planId], references: [id])

  interval        Interval
  status          SubscriptionStatus @default(TRIAL)

  // ë‚ ì§œ
  startedAt       DateTime @map("started_at")
  trialEndsAt     DateTime? @map("trial_ends_at")
  nextBillingDate DateTime? @map("next_billing_date")
  cancelledAt     DateTime? @map("cancelled_at")

  // ê²°ì œ
  paymentMethodId String?  @map("payment_method_id")
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])

  payments        Payment[]

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("subscriptions")
}

enum Interval {
  MONTHLY
  YEARLY
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  PAST_DUE
  CANCELLED
  EXPIRED
}

// ê²°ì œ ìˆ˜ë‹¨
model PaymentMethod {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  user            User     @relation(fields: [userId], references: [id])

  type            PaymentType

  // ì¹´ë“œ
  cardBrand       String?  @map("card_brand")
  cardLast4       String?  @map("card_last4")
  expiryDate      String?  @map("expiry_date")

  // ê³„ì¢Œ
  bankName        String?  @map("bank_name")
  accountLast4    String?  @map("account_last4")

  isDefault       Boolean  @default(false) @map("is_default")

  // PGì‚¬ ì •ë³´
  pgCustomerKey   String   @map("pg_customer_key")
  pgPaymentKey    String   @map("pg_payment_key")

  subscriptions   Subscription[]
  payments        Payment[]

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("payment_methods")
}

enum PaymentType {
  CARD
  BANK
}

// ê²°ì œ ë‚´ì—­
model Payment {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  user            User     @relation(fields: [userId], references: [id])

  subscriptionId  String   @map("subscription_id")
  subscription    Subscription @relation(fields: [subscriptionId], references: [id])

  planType        PlanType @map("plan_type")
  interval        Interval
  amount          Int

  // ê²°ì œ ìˆ˜ë‹¨
  paymentMethodId String?  @map("payment_method_id")
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])

  method          String
  cardLast4       String?  @map("card_last4")

  // PGì‚¬ ì •ë³´
  pgTransactionId String   @unique @map("pg_transaction_id")

  // ìƒíƒœ
  status          PaymentStatus @default(PENDING)

  // ë‚ ì§œ
  date            DateTime @default(now())
  refundedAt      DateTime? @map("refunded_at")
  refundReason    String?  @map("refund_reason")

  // ì˜ìˆ˜ì¦
  receiptUrl      String?  @map("receipt_url")

  refund          Refund?

  createdAt       DateTime @default(now()) @map("created_at")

  @@map("payments")
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

// í™˜ë¶ˆ
model Refund {
  id          String   @id @default(uuid())
  paymentId   String   @unique @map("payment_id")
  payment     Payment  @relation(fields: [paymentId], references: [id])

  amount      Int
  reason      String
  status      RefundStatus @default(PENDING)

  processedBy String?  @map("processed_by")
  processedAt DateTime? @map("processed_at")

  pgRefundId  String?  @map("pg_refund_id")

  createdAt   DateTime @default(now()) @map("created_at")

  @@map("refunds")
}

enum RefundStatus {
  PENDING
  COMPLETED
  REJECTED
}

// ë¬´ë£Œ ì²´í—˜
model FreeTrial {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  user            User     @relation(fields: [userId], references: [id])

  planType        PlanType @map("plan_type")
  startDate       DateTime @map("start_date")
  endDate         DateTime @map("end_date")

  status          TrialStatus @default(ACTIVE)

  convertedAt     DateTime? @map("converted_at")
  convertedToPlanId String? @map("converted_to_plan_id")

  createdAt       DateTime @default(now()) @map("created_at")

  @@map("free_trials")
}

enum TrialStatus {
  ACTIVE
  EXPIRED
  CONVERTED
}
```

---

13. ê°œë°œ ë¡œë“œë§µ
Phase 1: ê¸°ë°˜ ì‹œìŠ¤í…œ (3ì£¼)

Week 1

 Next.js 15 í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •
 Prisma Schema ì •ì˜ (Public + Tenant)
 NextAuth.js ì„¤ì • (Google, Kakao, Naver)
 íšŒì›ê°€ì… í¼ + DB ì €ì¥


Week 2

 ë¡œê·¸ì¸ + IP ë™ì‹œ ì ‘ì† ì œì–´
 Middleware (í…Œë„ŒíŠ¸ ì‹ë³„, IP ê²€ì¦)
 RBAC êµ¬í˜„ (ê¶Œí•œ ì²´í¬ í•¨ìˆ˜)


Week 3

 ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ (Tailwind CSS)
 í™”ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ í† ê¸€
 ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜



Phase 2: ì˜ìƒ ë¼ì´ë¸ŒëŸ¬ë¦¬ (4ì£¼)

Week 4

 Vimeo Provider êµ¬í˜„ (oEmbed API)
 ì˜ìƒ ë“±ë¡ UI (URL ì…ë ¥ â†’ ë©”íƒ€ë°ì´í„° ìë™)


Week 5

 Cloudflare Stream Provider êµ¬í˜„
 íŒŒì¼ ì—…ë¡œë“œ UI (Drag & Drop)


Week 6

 ìë§‰ íŒŒì¼ ì—…ë¡œë“œ (SRT/VTT)
 Cloudflare R2 ì—°ë™


Week 7

 OpenAI Whisper + GPT-4 ìë™ ë²ˆì—­
 ì˜ìƒ ì¹´ë“œ UI (ë§ˆìš°ìŠ¤ ì˜¤ë²„: ë¯¸ë¦¬ë³´ê¸°)
 ê²€ìƒ‰ + í•„í„°ë§



Phase 3: êµìœ¡ ì¡°í•© ë…¸ë“œ ì—ë””í„° (4ì£¼)

Week 8

 React Flow ì„¤ì¹˜ ë° ê¸°ë³¸ ì„¤ì •
 ë…¸ë“œ íƒ€ì… ì •ì˜ (VIDEO, IMAGE, PDF)


Week 9

 Drag & Dropìœ¼ë¡œ ë…¸ë“œ ì¶”ê°€
 ë…¸ë“œ ì—°ê²° (ì—£ì§€)


Week 10

 ë…¸ë“œ ì •ë³´ í¸ì§‘ UI
 êµìœ¡ ê³¼ì • ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°


Week 11

 êµìœ¡ ê³¼ì • ê³µìœ  ê¸°ëŠ¥
 êµìœ¡ ê³¼ì • ë³µì‚¬ ê¸°ëŠ¥



Phase 4: êµìœ¡ ì‹¤í–‰ ë° QR ì‹œìŠ¤í…œ (5ì£¼)

Week 12

 ì–¸ì–´ ì„ íƒ íŒì—… UI
 í•œêµ­ì–´: PC ì¬ìƒ (Video.js)


Week 13

 ì™¸êµ­ì–´: QR ì½”ë“œ ìƒì„± (JWT)
 ëª¨ë°”ì¼ QR ìŠ¤ìº” í˜ì´ì§€


Week 14

 ëª¨ë°”ì¼ ì˜ìƒ ì¬ìƒ + ìë§‰
 ì§„í–‰ë¥  íŠ¸ë˜í‚¹


Week 15

 êµìœ¡ ì™„ë£Œ í›„ QR ì½”ë“œ í‘œì‹œ
 QR í† í° ë§Œë£Œ ì²˜ë¦¬


Week 16

 ì¦ë¹™ ìˆ˜ì§‘ UI (ì´ë¦„, ì…€ì¹´, ì„œëª…)
 ê°œì¸ì •ë³´ ë™ì˜ ì²´í¬ë°•ìŠ¤



Phase 5: PDF ìƒì„± ë° ì´ë ¥ ê´€ë¦¬ (3ì£¼)

Week 17

 @react-pdf/renderer ì„¤ì •
 PDF í…œí”Œë¦¿ ì‘ì„± (í•œê¸€ í°íŠ¸)


Week 18

 PDF ìƒì„± API
 Cloudflare R2 ì—…ë¡œë“œ
 ëŒ€ì‹œë³´ë“œ ì•Œë¦¼ í‘œì‹œ


Week 19

 êµìœ¡ ì´ë ¥ ëª©ë¡ (í•„í„°ë§)
 ì›”ë³„ í†µê³„ ëŒ€ì‹œë³´ë“œ
 Excel ë³´ê³ ì„œ ìƒì„±



Phase 6: ê´€ë¦¬ì ê¸°ëŠ¥ ë° ìš´ì˜ (2ì£¼)

Week 20

 íšŒì› ê´€ë¦¬ (íšŒì‚¬ ê³„ì •)
 Excel ì¼ê´„ ë“±ë¡


Week 21

 ì—…ì¢…ë³„ ì¶”ì²œ ì˜ìƒ ì„¤ì •
 QR í† í° ì‹œê°„ ì„¤ì •
 ì´ë©”ì¼ ì•Œë¦¼ (Resend)



Phase 7: í…ŒìŠ¤íŠ¸ ë° ë°°í¬ (2ì£¼)

Week 22

 E2E í…ŒìŠ¤íŠ¸ (Playwright)
 ëª¨ë°”ì¼ ë°˜ì‘í˜• í…ŒìŠ¤íŠ¸
 ë‹¤êµ­ì–´ ìë§‰ ì •í™•ë„ ê²€ì¦


Week 23

 Vercel ë°°í¬
 Sentry ì—ëŸ¬ ëª¨ë‹ˆí„°ë§
 ì„±ëŠ¥ ìµœì í™” (Lighthouse 90+)



ì´ ì˜ˆìƒ ê¸°ê°„: 23ì£¼ (ì•½ 5.5ê°œì›”)
---

## ì—…ë°ì´íŠ¸ ì´ë ¥ (2025-01-21)

### ìµœê·¼ êµ¬í˜„ëœ ê¸°ëŠ¥

#### 1. ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ì‹œìŠ¤í…œ (ëª¨ë‹¬ ë°©ì‹)

**êµ¬í˜„ ë‚´ìš©:**
- 6ìë¦¬ ëœë¤ ì¸ì¦ë²ˆí˜¸ë¥¼ ì´ìš©í•œ ë³¸ì¸ í™•ì¸ ì‹œìŠ¤í…œ
- íœ´ëŒ€í° ë²ˆí˜¸ ë˜ëŠ” ì´ë©”ì¼ì„ ì„ íƒí•˜ì—¬ ì¸ì¦ ê°€ëŠ¥
- ëª¨ë‹¬ UIë¡œ êµ¬í˜„í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

**ì£¼ìš” íŒŒì¼:**
- `/components/FindEmailModal.tsx` - ì•„ì´ë”” ì°¾ê¸° ëª¨ë‹¬
- `/components/FindPasswordModal.tsx` - ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ëª¨ë‹¬
- `/app/api/auth/send-verification/route.ts` - ì¸ì¦ë²ˆí˜¸ ë°œì†¡ API
- `/app/api/auth/verify-code/route.ts` - ì¸ì¦ë²ˆí˜¸ ê²€ì¦ API
- `/app/api/auth/reset-password/route.ts` - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • API

**ì£¼ìš” ê¸°ëŠ¥:**

1. **ì•„ì´ë”” ì°¾ê¸° íë¦„:**
   ```
   ë°©ë²• ì„ íƒ (íœ´ëŒ€í°/ì´ë©”ì¼) 
   â†’ ì •ë³´ ì…ë ¥ 
   â†’ 6ìë¦¬ ì¸ì¦ë²ˆí˜¸ ì…ë ¥ 
   â†’ ì•„ì´ë”” í‘œì‹œ 
   â†’ ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ë¡œ ì´ë™ ì˜µì…˜ ì œê³µ
   ```

2. **ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° íë¦„:**
   ```
   ë°©ë²• ì„ íƒ (íœ´ëŒ€í°/ì´ë©”ì¼) 
   â†’ ì •ë³´ ì…ë ¥ 
   â†’ 6ìë¦¬ ì¸ì¦ë²ˆí˜¸ ì…ë ¥ 
   â†’ ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • 
   â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
   ```

3. **ë³´ì•ˆ ê¸°ëŠ¥:**
   - ì¸ì¦ë²ˆí˜¸ëŠ” 5ë¶„ê°„ ìœ íš¨
   - ì¸ì¦ë²ˆí˜¸ëŠ” global Mapì— ì €ì¥ (í”„ë¡œë•ì…˜ì—ì„œëŠ” Redis ì‚¬ìš© ê¶Œì¥)
   - ë¹„ë°€ë²ˆí˜¸ ê²€ì¦: 6ì ì´ìƒ, íŠ¹ìˆ˜ë¬¸ì í•„ìˆ˜ í¬í•¨
   - ë¹„ë°€ë²ˆí˜¸ í•´ì‹±: bcrypt (salt rounds: 12)
   - ë¦¬ì…‹ í† í°ì€ 10ë¶„ê°„ ìœ íš¨

**ì½”ë“œ ì˜ˆì‹œ:**

```typescript
// ì¸ì¦ë²ˆí˜¸ ìƒì„± ë° ì €ì¥
function generateVerificationCode(): string {
  return Math.floor(100000 + Math.random() * 900000).toString();
}

const verificationCodes = new Map();
verificationCodes.set(key, {
  code,
  expiresAt: Date.now() + 5 * 60 * 1000,
  type: "phone" | "email",
  purpose: "find-email" | "find-password"
});
```

---

#### 2. í™”ì´íŠ¸ ëª¨ë“œ í°íŠ¸ ìƒ‰ìƒ ìˆ˜ì •

**êµ¬í˜„ ë‚´ìš©:**
- ëª¨ë“  í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œì˜ í™”ì´íŠ¸ ëª¨ë“œ í°íŠ¸ ìƒ‰ìƒì„ ì¼ê´€ë˜ê²Œ ìˆ˜ì •
- `text-gray-900 dark:text-white` â†’ `text-black dark:text-white` ë¡œ ì „ë©´ ë³€ê²½

**ì˜í–¥ ë°›ì€ íŒŒì¼:** 
- 52ê°œ íŒŒì¼ ìˆ˜ì • (app í´ë” ë° components í´ë” ì „ì²´)
- ëª¨ë“  input, textarea, select ìš”ì†Œ

**ë³€ê²½ ì´ìœ :**
- í™”ì´íŠ¸ ëª¨ë“œì—ì„œ ë” ëª…í™•í•œ ê°€ë…ì„± ì œê³µ
- UI ì¼ê´€ì„± ê°œì„ 
- ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜

---

#### 3. ì˜ìƒ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ëª¨ë‹¬

**êµ¬í˜„ ë‚´ìš©:**
- ê´€ë¦¬ìê°€ ì˜ìƒ ì¹´í…Œê³ ë¦¬ë¥¼ ì§ì ‘ ìƒì„±/ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ìˆëŠ” ëª¨ë‹¬ UI
- ì˜ìƒ ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜ì´ì§€ì—ì„œ "ì¹´í…Œê³ ë¦¬ ê´€ë¦¬" ë²„íŠ¼ìœ¼ë¡œ ì ‘ê·¼

**ì£¼ìš” íŒŒì¼:**
- `/components/CategoryManagementModal.tsx`
- `/app/dashboard/videos/page.tsx` (í†µí•©)

**ê¸°ë³¸ ì¹´í…Œê³ ë¦¬:**
```typescript
const categories = [
  { id: "1", name: "ì œì¡°", icon: "ğŸ­" },
  { id: "2", name: "í™”í•™", icon: "âš—ï¸" },
  { id: "3", name: "ê±´ì„¤", icon: "ğŸ—ï¸" },
  { id: "4", name: "ê³µí†µ", icon: "ğŸ“š" },
  { id: "5", name: "ì¼ë°˜", icon: "ğŸ“‹" },
];
```

**ì£¼ìš” ê¸°ëŠ¥:**
1. **ì¹´í…Œê³ ë¦¬ ì¶”ê°€:** ì•„ì´ì½˜ê³¼ ì´ë¦„ì„ ì…ë ¥í•˜ì—¬ ìƒˆ ì¹´í…Œê³ ë¦¬ ìƒì„±
2. **ì¹´í…Œê³ ë¦¬ ìˆ˜ì •:** ì¸ë¼ì¸ í¸ì§‘ìœ¼ë¡œ ì´ë¦„ê³¼ ì•„ì´ì½˜ ë³€ê²½
3. **ì¹´í…Œê³ ë¦¬ ì‚­ì œ:** ì‚­ì œ ì „ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
4. **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸:** ë³€ê²½ì‚¬í•­ì´ ì¦‰ì‹œ UIì— ë°˜ì˜

**UI êµ¬ì¡°:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬                 [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€                     â”‚
â”‚ [ğŸ­] [ì¹´í…Œê³ ë¦¬ ì´ë¦„] [ì¶”ê°€]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬                      â”‚
â”‚ ğŸ­ ì œì¡°          [ìˆ˜ì •] [ì‚­ì œ]      â”‚
â”‚ âš—ï¸ í™”í•™          [ìˆ˜ì •] [ì‚­ì œ]      â”‚
â”‚ ğŸ—ï¸ ê±´ì„¤          [ìˆ˜ì •] [ì‚­ì œ]      â”‚
â”‚ ğŸ“š ê³µí†µ          [ìˆ˜ì •] [ì‚­ì œ]      â”‚
â”‚ ğŸ“‹ ì¼ë°˜          [ìˆ˜ì •] [ì‚­ì œ]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 4. ì˜ìƒ ë“±ë¡ ëª¨ë‹¬ (ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° í¬í•¨)

**êµ¬í˜„ ë‚´ìš©:**
- ì˜ìƒ ë“±ë¡ì„ ëª¨ë‹¬ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
- React Quill ê¸°ë°˜ ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° í†µí•©
- ì¹´í…Œê³ ë¦¬ ì„ íƒ, íƒœê·¸ ì…ë ¥, ìƒì„¸ ë‚´ìš© ì‘ì„± ê¸°ëŠ¥ ì¶”ê°€

**ì£¼ìš” íŒŒì¼:**
- `/components/VideoUploadModal.tsx`
- `/app/dashboard/videos/page.tsx` (í†µí•©)

**ì„¤ì¹˜ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬:**
```bash
npm install react-quill quill
```

**ì£¼ìš” ê¸°ëŠ¥:**

1. **ì—…ë¡œë“œ ë°©ì‹ ì„ íƒ:**
   - URL ì…ë ¥ (Vimeo, Cloudflare Stream)
   - íŒŒì¼ ì—…ë¡œë“œ (ìµœëŒ€ 2GB, MP4/WebM/MOV ë“±)
   - Drag & Drop ì§€ì›

2. **ìƒì„¸ ì •ë³´ ì…ë ¥:**
   - **êµìœ¡ ì œëª©*** (í•„ìˆ˜)
   - **ì¹´í…Œê³ ë¦¬*** (í•„ìˆ˜, ë“œë¡­ë‹¤ìš´)
   - **íƒœê·¸** (ê²€ìƒ‰ìš©, ë‹¤ì¤‘ ì…ë ¥ ê°€ëŠ¥)
   - **êµìœ¡ ë‚´ìš© ìš”ì•½** (ê°„ë‹¨í•œ ì„¤ëª…)
   - **ìƒì„¸ ë‚´ìš©** (ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„°)

3. **ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ê¸°ëŠ¥:**
   - í—¤ë” (H1, H2, H3)
   - í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ (êµµê²Œ, ê¸°ìš¸ì„, ë°‘ì¤„, ì·¨ì†Œì„ )
   - ìƒ‰ìƒ ë° ë°°ê²½ìƒ‰
   - ë¦¬ìŠ¤íŠ¸ (ìˆœì„œ, ë¹„ìˆœì„œ)
   - ì •ë ¬
   - ë§í¬ ë° ì´ë¯¸ì§€ ì‚½ì…
   - ì„œì‹ ì§€ìš°ê¸°

4. **ì—…ë¡œë“œ ì§„í–‰ë¥  í‘œì‹œ:**
   - íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì‹¤ì‹œê°„ ì§„í–‰ë¥  í‘œì‹œ
   - í”„ë¡œê·¸ë ˆìŠ¤ ë°” (0-100%)

**ì½”ë“œ êµ¬ì¡°:**

```typescript
interface VideoUploadModalProps {
  onClose: () => void;
  onSuccess?: () => void;
}

const [formData, setFormData] = useState({
  title: "",
  summary: "",
  detailedContent: "",  // ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ë‚´ìš©
  category: "",
  tags: [] as string[],
  isPublic: true,
});

// Quill ì—ë””í„° ì„¤ì •
const modules = {
  toolbar: [
    [{ header: [1, 2, 3, false] }],
    ["bold", "italic", "underline", "strike"],
    [{ color: [] }, { background: [] }],
    [{ list: "ordered" }, { list: "bullet" }],
    [{ align: [] }],
    ["link", "image"],
    ["clean"],
  ],
};
```

**ëª¨ë‹¬ UI êµ¬ì¡°:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì˜ìƒ ë“±ë¡                           [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ”— URL ì…ë ¥] [ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì˜ìƒ URL: [________________] [ë¯¸ë¦¬ë³´ê¸°]  â”‚
â”‚                                           â”‚
â”‚ ë¯¸ë¦¬ë³´ê¸°:                                 â”‚
â”‚ [ì¸ë„¤ì¼] ì œê³µì: Vimeo                    â”‚
â”‚          ì‹œê°„: 10ë¶„ 30ì´ˆ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ êµìœ¡ ì œëª©*: [_________________________]  â”‚
â”‚                                           â”‚
â”‚ ì¹´í…Œê³ ë¦¬*: [ì œì¡° â–¼]                      â”‚
â”‚                                           â”‚
â”‚ íƒœê·¸: [íƒœê·¸ ì…ë ¥] [ì¶”ê°€]                 â”‚
â”‚ [ì•ˆì „êµìœ¡ x] [ì‚°ì—…ì•ˆì „ x] [ì œì¡°ì—… x]     â”‚
â”‚                                           â”‚
â”‚ êµìœ¡ ë‚´ìš© ìš”ì•½:                           â”‚
â”‚ [_____________________________________]  â”‚
â”‚ [_____________________________________]  â”‚
â”‚                                           â”‚
â”‚ ìƒì„¸ ë‚´ìš©:                                â”‚
â”‚ [ìƒì„¸ ë‚´ìš© ì‘ì„±í•˜ê¸° (í´ë¦­)]              â”‚
â”‚                                           â”‚
â”‚ â˜‘ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ê³µê°œ                   â”‚
â”‚                                           â”‚
â”‚                     [ì·¨ì†Œ] [ë“±ë¡í•˜ê¸°]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ìƒì„¸ ë‚´ìš© í¸ì§‘ ëª¨ë‹¬ (ë³„ë„):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ìƒì„¸ ë‚´ìš© ì‘ì„±                      [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [H] [B] [I] [U] [S] [ìƒ‰] [ë°°ê²½] [ì •ë ¬].. â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                       â”‚ â”‚
â”‚ â”‚   ë¦¬ì¹˜ í…ìŠ¤íŠ¸ í¸ì§‘ ì˜ì—­                â”‚ â”‚
â”‚ â”‚                                       â”‚ â”‚
â”‚ â”‚   - í°íŠ¸ ìŠ¤íƒ€ì¼ ë³€ê²½                   â”‚ â”‚
â”‚ â”‚   - ì´ë¯¸ì§€ ì‚½ì…                        â”‚ â”‚
â”‚ â”‚   - ë§í¬ ì‚½ì…                          â”‚ â”‚
â”‚ â”‚                                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              [ì™„ë£Œ]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‚¬ìš© ì˜ˆì‹œ:**

```typescript
// ì˜ìƒ ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜ì´ì§€ì—ì„œ ì‚¬ìš©
<button
  onClick={() => setShowUploadModal(true)}
  className="px-4 py-2 bg-blue-600 text-white rounded-lg"
>
  <span className="material-symbols-outlined text-sm">add</span>
  <span>ì˜ìƒ ë“±ë¡</span>
</button>

{showUploadModal && (
  <VideoUploadModal
    onClose={() => setShowUploadModal(false)}
    onSuccess={() => {
      setShowUploadModal(false);
      fetchVideos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    }}
  />
)}
```

---

### ê¸°ìˆ  ìŠ¤íƒ ì—…ë°ì´íŠ¸

**ì¶”ê°€ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬:**

```json
{
  "dependencies": {
    "react-quill": "^2.0.0",
    "quill": "^1.3.7"
  }
}
```

**Rich Text Editor ì„¤ì •:**

```typescript
// Next.jsì—ì„œ react-quillì„ dynamic importë¡œ ì‚¬ìš© (SSR ë°©ì§€)
import dynamic from "next/dynamic";
const ReactQuill = dynamic(() => import("react-quill"), { ssr: false });

// CSS ì„í¬íŠ¸
import "react-quill/dist/quill.snow.css";
```

---

### UI/UX ê°œì„  ì‚¬í•­

1. **ëª¨ë‹¬ UI ì¼ê´€ì„±:**
   - ëª¨ë“  ëª¨ë‹¬ì—ì„œ ë™ì¼í•œ ë””ìì¸ íŒ¨í„´ ì ìš©
   - ë‹«ê¸° ë²„íŠ¼ ìœ„ì¹˜ í†µì¼ (ìš°ì¸¡ ìƒë‹¨)
   - ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¼ê´€ì„± (ì·¨ì†Œ/í™•ì¸)

2. **ë‹¤í¬ ëª¨ë“œ ì§€ì›:**
   - ëª¨ë“  ìƒˆ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë‹¤í¬ ëª¨ë“œ ì™„ë²½ ì§€ì›
   - `dark:` prefixë¥¼ ì‚¬ìš©í•œ Tailwind CSS í´ë˜ìŠ¤

3. **ë°˜ì‘í˜• ë””ìì¸:**
   - ëª¨ë°”ì¼, íƒœë¸”ë¦¿, ë°ìŠ¤í¬í†± ëª¨ë‘ ì§€ì›
   - ëª¨ë‹¬ í¬ê¸° ë° ë ˆì´ì•„ì›ƒ ìë™ ì¡°ì •

4. **ì ‘ê·¼ì„±:**
   - Material Symbols Icons ì‚¬ìš©
   - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì§€ì› (Enter í‚¤ë¡œ ì œì¶œ ë“±)
   - í¬ì»¤ìŠ¤ ê´€ë¦¬ (ìë™ í¬ì»¤ìŠ¤ ì´ë™)

---

### ë³´ì•ˆ ê°œì„  ì‚¬í•­

1. **ì¸ì¦ë²ˆí˜¸ ì‹œìŠ¤í…œ:**
   - 5ë¶„ íƒ€ì„ì•„ì›ƒ ìë™ ì ìš©
   - ì¼íšŒìš© ì½”ë“œ (ì‚¬ìš© í›„ ì‚­ì œ)
   - Rate limiting ê³ ë ¤ í•„ìš” (í”„ë¡œë•ì…˜)

2. **ë¹„ë°€ë²ˆí˜¸ ì •ì±…:**
   - ìµœì†Œ 6ì ì´ìƒ
   - íŠ¹ìˆ˜ë¬¸ì í•„ìˆ˜ í¬í•¨
   - bcrypt í•´ì‹± (salt rounds: 12)

3. **íŒŒì¼ ì—…ë¡œë“œ ê²€ì¦:**
   - íŒŒì¼ í¬ê¸° ì œí•œ (ìµœëŒ€ 2GB)
   - íŒŒì¼ í˜•ì‹ ê²€ì¦ (video/* MIME íƒ€ì…)
   - XHR ê¸°ë°˜ ì—…ë¡œë“œë¡œ ì§„í–‰ë¥  ì¶”ì 

---

### ë‹¤ìŒ ë‹¨ê³„ (ê¶Œì¥ ì‚¬í•­)

1. **API í†µí•©:**
   - ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ API êµ¬í˜„ (`/api/categories`)
   - ì˜ìƒ ìƒì„¸ ì •ë³´ ì €ì¥ í•„ë“œ í™•ì¥ (tags, detailedContent)

2. **Redis ë§ˆì´ê·¸ë ˆì´ì…˜:**
   - ì¸ì¦ë²ˆí˜¸ ì €ì¥ì„ global Mapì—ì„œ Redisë¡œ ì „í™˜
   - ì„¸ì…˜ ê´€ë¦¬ ê°œì„ 

3. **ì´ë¯¸ì§€ ì—…ë¡œë“œ:**
   - ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„°ì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„
   - Cloudflare R2 ì—°ë™

4. **ê²€ìƒ‰ ìµœì í™”:**
   - íƒœê·¸ ê¸°ë°˜ ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰ (PostgreSQL full-text search)
   - Elasticsearch í†µí•© ê³ ë ¤

5. **í…ŒìŠ¤íŠ¸:**
   - ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
   - E2E í…ŒìŠ¤íŠ¸ (Playwright)
   - ëª¨ë°”ì¼ ë°˜ì‘í˜• í…ŒìŠ¤íŠ¸

---

### ë²„ê·¸ ìˆ˜ì • ë° ë§ˆì´ë„ˆ ê°œì„ 

1. **íšŒì›ê°€ì… í¼:**
   - íšŒì‚¬ëª…(ì—…ì²´ëª…) í•„ë“œë¥¼ ì„ íƒì‚¬í•­ìœ¼ë¡œ ë³€ê²½
   - ê´€ë¦¬ì íšŒì› ì¶”ê°€ ëª¨ë‹¬ì—ë„ íšŒì‚¬ëª… í•„ë“œ ì¶”ê°€

2. **í°íŠ¸ ì¼ê´€ì„±:**
   - ëª¨ë“  ì…ë ¥ í•„ë“œì—ì„œ í™”ì´íŠ¸ ëª¨ë“œ ì‹œ ê²€ì€ìƒ‰ í°íŠ¸ ì ìš©
   - ë‹¤í¬ ëª¨ë“œ ì‹œ í°ìƒ‰ í°íŠ¸ ìœ ì§€

3. **ë¹Œë“œ ìµœì í™”:**
   - Dynamic import ì‚¬ìš©ìœ¼ë¡œ ë²ˆë“¤ í¬ê¸° ìµœì í™”
   - react-quillì„ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œë§Œ ë¡œë“œ

---

### ì»¤ë°‹ ì´ë ¥

```bash
# 2025-01-21
feat: ID/Password finding with 6-digit verification and optional company name
feat: Convert ID/Password finding to modal components
feat: white mode font fixes and category management modal
feat: video upload modal with rich text editor
feat: video upload modal improvements and icon picker
```

---

#### 5. ì•„ì´ì½˜ ì„ íƒê¸° ë° ì˜ìƒ ë“±ë¡ ëª¨ë‹¬ ê°œì„  (2025-01-21 ì—…ë°ì´íŠ¸)

**êµ¬í˜„ ë‚´ìš©:**
- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ëª¨ë‹¬ì— ì•„ì´ì½˜ ì„ íƒ íŒì—… ì¶”ê°€
- ì˜ìƒ ë“±ë¡ ëª¨ë‹¬ UX ê°œì„  (ë¯¸ë¦¬ë³´ê¸° í•„ìˆ˜ ì œê±°)
- ê¶Œí•œ ê¸°ë°˜ ê³µê°œ ì˜µì…˜ í‘œì‹œ (ì¼ë°˜ ì‚¬ìš©ìë§Œ)
- "ì²« ì˜ìƒ ë“±ë¡í•˜ê¸°" ë²„íŠ¼ì„ ëª¨ë‹¬ ë°©ì‹ìœ¼ë¡œ ë³€ê²½

**ì£¼ìš” íŒŒì¼:**
- `/components/CategoryManagementModal.tsx` - ì•„ì´ì½˜ ì„ íƒê¸° ì¶”ê°€
- `/components/VideoUploadModal.tsx` - UX ê°œì„  ë° ê¶Œí•œ ê¸°ë°˜ UI
- `/app/dashboard/videos/page.tsx` - ì—­í•  ê°ì§€ ë° ëª¨ë‹¬ í†µí•©

**ì£¼ìš” ê¸°ëŠ¥:**

1. **ì•„ì´ì½˜ ì„ íƒê¸° (Icon Picker):**
   - 64ê°œ ì´ëª¨ì§€ ì•„ì´ì½˜ ì œê³µ
   - 8x8 ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ
   - í´ë¦­ ì‹œ íŒì—… ëª¨ë‹¬ë¡œ í‘œì‹œ
   - ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ë° í¸ì§‘ ëª¨ë“œ ëª¨ë‘ ì§€ì›

   ```typescript
   const AVAILABLE_ICONS = [
     "ğŸ­", "âš—ï¸", "ğŸ—ï¸", "ğŸ“š", "ğŸ“‹", "ğŸ”§", "âš™ï¸", "ğŸ”¨",
     "ğŸ¢", "ğŸª", "ğŸ¬", "ğŸ­", "ğŸ—ï¸", "â›ï¸", "ğŸ”©", "âš¡",
     // ... ì´ 64ê°œ
   ];

   // ì•„ì´ì½˜ ë²„íŠ¼ (í…ìŠ¤íŠ¸ ì…ë ¥ ëŒ€ì²´)
   <button
     onClick={() => setShowIconPicker(true)}
     className="w-20 px-3 py-2 border text-2xl text-center"
   >
     {newCategoryIcon}
   </button>

   // ì•„ì´ì½˜ ì„ íƒ íŒì—… (z-[60]ë¡œ ë©”ì¸ ëª¨ë‹¬ ìœ„ì— í‘œì‹œ)
   {showIconPicker && (
     <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]">
       <div className="grid grid-cols-8 gap-2">
         {AVAILABLE_ICONS.map((icon, idx) => (
           <button onClick={() => {
             setNewCategoryIcon(icon);
             setShowIconPicker(false);
           }}>
             {icon}
           </button>
         ))}
       </div>
     </div>
   )}
   ```

2. **ì˜ìƒ ë“±ë¡ ëª¨ë‹¬ UX ê°œì„ :**
   - **ë¯¸ë¦¬ë³´ê¸° í•„ìˆ˜ ì œê±°:** ì´ì œ URL ì…ë ¥/íŒŒì¼ ì„ íƒ í›„ ë°”ë¡œ ëª¨ë“  ì…ë ¥ í•„ë“œ í‘œì‹œ
   - **ë¯¸ë¦¬ë³´ê¸°ëŠ” ì„ íƒì‚¬í•­:** ì •ë³´ í™•ì¸ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©
   - **ì¦‰ì‹œ ì…ë ¥ ê°€ëŠ¥:** ì œëª©, ì¹´í…Œê³ ë¦¬, íƒœê·¸, ìš”ì•½, ìƒì„¸ ë‚´ìš©ì„ ë°”ë¡œ ì‘ì„± ê°€ëŠ¥

   ë³€ê²½ ì „:
   ```
   URL ì…ë ¥ â†’ [ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼ í´ë¦­ í•„ìˆ˜] â†’ ë©”íƒ€ë°ì´í„° ë¡œë“œ â†’ ì…ë ¥ í•„ë“œ í‘œì‹œ
   ```

   ë³€ê²½ í›„:
   ```
   URL ì…ë ¥ ë˜ëŠ” íŒŒì¼ ì„ íƒ â†’ ì…ë ¥ í•„ë“œ ì¦‰ì‹œ í‘œì‹œ (ë¯¸ë¦¬ë³´ê¸°ëŠ” ì„ íƒì‚¬í•­)
   ```

3. **ê¶Œí•œ ê¸°ë°˜ ê³µê°œ ì˜µì…˜:**
   - **ê´€ë¦¬ì/ë³´ì¡° ê´€ë¦¬ì:** "ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ê³µê°œ" ì²´í¬ë°•ìŠ¤ ìˆ¨ê¹€
   - **ì¼ë°˜ ì‚¬ìš©ì:** ê³µê°œ ì˜µì…˜ í‘œì‹œ

   ```typescript
   interface VideoUploadModalProps {
     onClose: () => void;
     onSuccess?: () => void;
     userRole?: string; // "ADMIN", "SUB_ADMIN", "USER"
   }

   // ê¶Œí•œ ê¸°ë°˜ ë Œë”ë§
   {userRole !== "ADMIN" && userRole !== "SUB_ADMIN" && (
     <div>
       <label className="flex items-center">
         <input type="checkbox" checked={formData.isPublic} />
         <span>ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ê³µê°œ</span>
       </label>
     </div>
   )}
   ```

4. **ì²« ì˜ìƒ ë“±ë¡í•˜ê¸° ë²„íŠ¼:**
   - `/dashboard/videos/new` ë§í¬ë¥¼ ëª¨ë‹¬ íŠ¸ë¦¬ê±° ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
   - ê¸°ì¡´ "ì˜ìƒ ë“±ë¡" ë²„íŠ¼ê³¼ ë™ì¼í•œ ëª¨ë‹¬ ì‚¬ìš©

   ë³€ê²½ ì „:
   ```tsx
   <Link href="/dashboard/videos/new">ì²« ì˜ìƒ ë“±ë¡í•˜ê¸°</Link>
   ```

   ë³€ê²½ í›„:
   ```tsx
   <button onClick={() => setShowUploadModal(true)}>
     ì²« ì˜ìƒ ë“±ë¡í•˜ê¸°
   </button>
   ```

**ê¸°ìˆ ì  ê°œì„ ì‚¬í•­:**

1. **ì—­í•  ê°ì§€ ì‹œìŠ¤í…œ:**
   ```typescript
   // videos/page.tsx
   const [userRole, setUserRole] = useState<string>("USER");

   const fetchUserRole = async () => {
     const response = await fetch("/api/auth/session");
     const data = await response.json();
     if (data.user?.role) {
       setUserRole(data.user.role);
     }
   };

   // VideoUploadModalì— ì „ë‹¬
   <VideoUploadModal userRole={userRole} />
   ```

2. **TypeScript íƒ€ì… ì•ˆì „ì„±:**
   - ë¯¸ë¦¬ë³´ê¸° ë°ì´í„°ê°€ nullì¼ ìˆ˜ ìˆëŠ” ê²½ìš° ì²˜ë¦¬
   - Optional chaining ì‚¬ìš©

   ```typescript
   videoUrl: uploadMethod === "url"
     ? videoUrl
     : preview
     ? `https://videodelivery.net/${preview.providerId}`
     : ""
   ```

3. **ê²€ì¦ ë¡œì§ ê°œì„ :**
   ```typescript
   // URL ë°©ì‹
   if (uploadMethod === "url" && !videoUrl.trim()) {
     setError("ì˜ìƒ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
     return;
   }

   // íŒŒì¼ ì—…ë¡œë“œ ë°©ì‹
   if (uploadMethod === "file" && !selectedFile && !preview) {
     setError("íŒŒì¼ì„ ì„ íƒí•˜ê³  ì—…ë¡œë“œí•´ì£¼ì„¸ìš”");
     return;
   }
   ```

**UI ê³„ì¸µ êµ¬ì¡°:**
```
ë©”ì¸ ëª¨ë‹¬ (z-50)
  â””â”€ ì˜ìƒ ë“±ë¡ í¼
      â””â”€ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ëª¨ë‹¬ (z-50)
          â””â”€ ì•„ì´ì½˜ ì„ íƒ íŒì—… (z-[60])
```

**ë¹Œë“œ ê²°ê³¼:**
- âœ… TypeScript ì»´íŒŒì¼ ì„±ê³µ
- âœ… ëª¨ë“  íƒ€ì… ê²€ì¦ í†µê³¼
- âœ… 80ê°œ ë¼ìš°íŠ¸ ì •ì  ìƒì„± ì™„ë£Œ

---
